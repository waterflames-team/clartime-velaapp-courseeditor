<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="author" content="Eason Chen">
  <meta name="email" content="admin@xuanimage.top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¾„åºè¯¾ç¨‹è¡¨-é…ç½®ç”Ÿæˆå™¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#10b981',
            neutral: '#f1f5f9',
            dark: '#1e293b'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .step-active {
        @apply bg-primary text-white border-primary;
      }
      .step-completed {
        @apply bg-accent text-white border-accent;
      }
      .step-pending {
        @apply bg-white text-secondary border-secondary;
      }
      .form-input-focus {
        @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .template-locked {
        @apply border-dashed border-gray-400 bg-gray-50;
      }
      .no-course-message {
        @apply text-gray-500 italic text-sm mt-2;
      }
    }
  </style>

  <style>
    /* å…¨å±é®ç½©æ ·å¼ - ç™½è‰²èƒŒæ™¯ */
    .qq-mask {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #fff;
      /* å…¨ç™½è‰²èƒŒæ™¯ */
      z-index: 50;
      /* ä¸ç°æœ‰å¼¹çª—ç›¸åŒå±‚çº§ */
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    /* æ˜¾ç¤ºé®ç½© */
    .qq-mask.show {
      opacity: 1;
      visibility: visible;
    }

    /* æç¤ºå¼¹çª—æ ·å¼ */
    .qq-alert {
      background: #fff;
      width: 100%;
      max-width: 420px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      padding: 36px 24px;
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .qq-mask.show .qq-alert {
      transform: scale(1);
    }

    .qq-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2312B7F5'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z'/%3E%3C/svg%3E") no-repeat center;
      background-size: contain;
    }

    .qq-alert h2 {
      font-size: 22px;
      color: #333;
      margin-bottom: 12px;
    }

    .qq-alert p {
      font-size: 15px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 24px;
      padding: 0 10px;
    }

    /* æŒ‰é’®æ ·å¼ */
    .action-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 16px;
    }

    .action-btn {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 140px;
      justify-content: center;
    }

    .action-btn:hover {
      transform: translateY(-2px);
    }

    .btn-copy {
      background-color: #4285f4;
      color: #fff;
    }

    .btn-copy:hover {
      background-color: #3367d6;
    }

    .btn-continue {
      background-color: #f1f3f4;
      color: #333;
    }

    .btn-continue:hover {
      background-color: #e8eaed;
    }

    /* æ­£å¸¸å†…å®¹åŒºåŸŸ */
    .normal-content {
      text-align: center;
      padding: 40px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .normal-content h1 {
      color: #333;
      margin-bottom: 16px;
    }

    .normal-content p {
      color: #666;
      font-size: 16px;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
  <!-- QQå®¢æˆ·ç«¯æç¤ºé®ç½© -->
  <div class="qq-mask" id="qqMask">
    <div class="qq-alert">
      <div class="qq-icon"></div>
      <h2>æ£€æµ‹åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨QQå†…ç½®æµè§ˆå™¨</h2>
      <p>ä¸ºäº†è·å¾—æ›´å¥½çš„æµè§ˆä½“éªŒå’ŒåŠŸèƒ½æ”¯æŒï¼Œå»ºè®®æ‚¨å¤åˆ¶é“¾æ¥åˆ°å…¶ä»–æµè§ˆå™¨æ‰“å¼€</p>
      <div class="action-buttons">
        <button class="action-btn btn-copy" onclick="copyLink()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="#fff">
            <path
              d="M19.071 10.929a7 7 0 100 9.899l1.414-1.414a9 9 0 110-12.728l-1.414 1.414zM12 13a1 1 0 01-1-1V9a1 1 0 012 0v3a1 1 0 01-1 1z" />
          </svg>
          å¤åˆ¶é“¾æ¥
        </button>
        <button class="action-btn btn-continue" onclick="continueAccess()">
          ç»§ç»­è®¿é—®
        </button>
      </div>
    </div>
  </div>

  <!-- å…¬å‘Šå¼¹çª— -->
  <div id="announcementModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
    style="visibility:hidden">
    <div
      class="bg-white rounded-xl shadow-lg max-w-2xl w-full mx-4 overflow-hidden transform transition-all duration-300 scale-100">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <div class="bg-primary text-white px-6 py-4 flex justify-between items-center">
        <h3 class="text-lg font-bold">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</h3>
        <button id="closeAnnouncementBtn" class="text-white hover:text-gray-200 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <!-- å¼¹çª—å†…å®¹ï¼ˆå¯è‡ªå®šä¹‰ HTMLï¼‰ -->
      <div class="p-6 space-y-4">
        <p class="text-gray-700">ä½¿ç”¨å¸®åŠ©</p>
        <ul class="list-disc pl-5 text-gray-600 space-y-2">
          <li>è¯¥é¡µé¢ä¸º <a href="https://www.waterflames.cn/">æ¾„åºè¯¾ç¨‹è¡¨â€”â€”è¯¾ç¨‹è…•ä¸ŠæŠ¬æ‰‹çœ‹</a> é…ç½®é¡µé¢ V0.2.0-Beta </li>
          <li>è‹¥é‡åˆ°å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œè¯·ç‚¹å‡»ã€Œä¿å­˜é…ç½®ã€ååˆ·æ–°é¡µé¢ï¼Œã€ŒåŠ è½½é…ç½®ã€åå³å¯é‡æ–°é…ç½®</li>
          <li>è‹¥å¯¼å…¥å¤±è´¥è¯·æ£€æŸ¥æ•°æ®æ ¼å¼è§„èŒƒ</li>
          <li>æµ‹è¯•ç¾¤ï¼š1042873150</li>
        </ul>
        <div class="pt-2 text-right">
          <a href="https://github.com/cyx200902/">
            <span class="text-sm text-gray-500">Eason Chen</span><br>
          </a>
          <span class="text-sm text-gray-500">25.8.30</span>
        </div>
      </div>
      <!-- å¼¹çª—åº•éƒ¨ -->
      <div class="bg-gray-50 px-6 py-4 flex justify-end">
        <button id="confirmAnnouncementBtn"
          class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-check mr-2"></i>æˆ‘å·²çŸ¥æ™“
        </button>
      </div>
    </div>
  </div>

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white shadow-sm sticky top-0 z-40">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-calendar-check-o text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-dark">æ¾„åºè¯¾ç¨‹è¡¨é…ç½®ç”Ÿæˆå™¨</h1>
      </div>
      <div class="flex items-center space-x-4">
        <a href="https://astrobox.online/open?source=res&res=%E6%BE%84%E5%BA%8F%E8%AF%BE%E7%A8%8B%E8%A1%A8&provider=official"
          target="_blank" rel="noopener noreferrer">
          <img height="40px" src="https://astrobox.online/goab/en/white.svg">
        </a>
        <button id="saveBtn"
          class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-save mr-2"></i>ä¿å­˜é…ç½®
        </button>

        <input type="file" id="fileInput" accept=".json,.wakeup_schedule" class="hidden">
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="mb-10">
      <div class="flex flex-wrap items-center justify-between">

        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step0Indicator"
            class="step-active w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">0</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">å¼€å§‹é…ç½®</h2>
            <p class="text-sm text-gray-500">ä»æ–°å»º/å¯¼å…¥å¼€å§‹</p>
          </div>
        </div>

        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar0" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%">
          </div>
        </div>

        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step1Indicator"
            class="step-active w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">1</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">åŸºç¡€ä¿¡æ¯è®¾ç½®</h2>
            <p class="text-sm text-gray-500">é…ç½®è¯¾ç¨‹è¡¨çš„åŸºæœ¬ä¿¡æ¯</p>
          </div>
        </div>

        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar1" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%">
          </div>
        </div>

        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step2Indicator"
            class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">2</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h2>
            <p class="text-sm text-gray-500">æ·»åŠ å’Œç¼–è¾‘è¯¾ç¨‹è¯¦æƒ…</p>
          </div>
        </div>

        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar2" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%">
          </div>
        </div>

        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step3Indicator"
            class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">3</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">æ—¶é—´è¡¨æ¨¡æ¿</h2>
            <p class="text-sm text-gray-500">è®¾ç½®æ¯æ—¥æ—¶é—´èŠ‚ç‚¹</p>
          </div>
        </div>

        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar3" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%">
          </div>
        </div>

        <div class="flex items-center w-full md:w-auto">
          <div id="step4Indicator"
            class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">4</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">è¯¾ç¨‹å®‰æ’</h2>
            <p class="text-sm text-gray-500">åˆ†é…æ¯æ—¥è¯¾ç¨‹</p>
          </div>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤å†…å®¹åŒºåŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- å·¦ä¾§è¡¨å•åŒºåŸŸ -->
      <div class="lg:col-span-2 space-y-6">

        <!-- æ­¥éª¤0: å¼€å§‹é…ç½® -->
        <div id="step0" class="bg-white rounded-xl shadow-sm p-6 transition-all">
          <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-100">å¼€å§‹é…ç½®</h3>
          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <h1>é€‰æ‹©ä»¥å¼€å§‹</h1><br>

              <div class="grid grid-cols-1">
                <label class="block text-sm font-medium text-gray-700 mb-1" for="dataStructureVersion">æ–°å»ºè¯¾è¡¨</label>
                <button id="NewBtn"
                  class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center">
                  <i class="fa fa-plus-square mr-2"></i>æ–°å»ºè¯¾è¡¨</i>
                </button>
              </div>

              <div class="grid grid-cols-1">
                <label class="block text-sm font-medium text-gray-700 mb-1" for="name">å¯¼å…¥å®˜æ–¹è¯¾è¡¨æˆ–Wakeupæ•°æ®</label>
                <button id="loadBtn"
                  class="bg-secondary hover:bg-secondary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
                  <i class="fa fa-upload mr-2"></i>åŠ è½½é…ç½®
                </button>
              </div>


            </div>
          </div>
        </div>

        <!-- æ­¥éª¤1: åŸºç¡€ä¿¡æ¯ -->
        <div id="step1" class="bg-white rounded-xl shadow-sm p-6 transition-all">
          <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-100">è¯¾ç¨‹è¡¨åŸºç¡€ä¿¡æ¯</h3>

          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="dataStructureVersion">æ•°æ®æ ¼å¼ç‰ˆæœ¬</label>
                <input type="text" id="dataStructureVersion" value="1.1"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus cursor-not-allowed"
                  disabled>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="name">è¯¾ç¨‹è¡¨åç§°</label>
                <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šé«˜äºŒä¸‹å­¦æœŸè¯¾ç¨‹è¡¨"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="createTime">åˆ›å»ºæ—¶é—´</label>
                <input type="text" id="createTime" placeholder="æ ¼å¼ï¼šYYMMDDHHmmss"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="updateTime">ä¿®æ”¹æ—¶é—´</label>
                <input type="text" id="updateTime" placeholder="æ ¼å¼ï¼šYYMMDDHHmmss"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="courseStart">è¯¾ç¨‹å¼€å§‹æ—¥æœŸ</label>
                <input type="text" id="courseStart" placeholder="æ ¼å¼ï¼šYYMMDD"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="courseEnd">è¯¾ç¨‹ç»“æŸæ—¥æœŸ</label>
                <input type="text" id="courseEnd" placeholder="æ ¼å¼ï¼šYYMMDD"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>
          </div>
        </div>

        <!-- æ­¥éª¤2: è¯¾ç¨‹ä¿¡æ¯ -->
        <div id="step2" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold pb-2 border-b border-gray-100">è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h3>
            <button id="addCourseBtn"
              class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
              <i class="fa fa-plus mr-2"></i>æ·»åŠ è¯¾ç¨‹
            </button>
          </div>

          <div id="coursesContainer" class="space-y-4">
            <!-- è¯¾ç¨‹å¡ç‰‡ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
          </div>
        </div>

        <!-- æ­¥éª¤3: æ—¶é—´è¡¨æ¨¡æ¿ -->
        <div id="step3" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold pb-2 border-b border-gray-100">æ—¶é—´è¡¨æ¨¡æ¿ç®¡ç†</h3>
            <button id="addTemplateBtn"
              class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
              <i class="fa fa-plus mr-2"></i>æ·»åŠ æ¨¡æ¿
            </button>
          </div>

          <div id="templatesContainer" class="space-y-8">
            <!-- é”å®šçš„æ— è¯¾ç¨‹æ¨¡æ¿ -->

          </div>
        </div>

        <!-- æ­¥éª¤4: è¯¾ç¨‹å®‰æ’ -->
        <div id="step4" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-100">è¯¾ç¨‹å®‰æ’</h3>

          <div id="scheduleContainer" class="space-y-6">
            <!-- æ¯å¤©çš„å®‰æ’ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            <!-- å‘¨ä¸€åˆ°å‘¨æ—¥ä¼šé€šè¿‡JSè‡ªåŠ¨ç”Ÿæˆ -->
          </div>
        </div>

        <!-- å¯¼èˆªæŒ‰é’® -->
        <div class="flex justify-between mt-8">
          <button id="prevBtn"
            class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center opacity-50 cursor-not-allowed">
            <i class="fa fa-arrow-left mr-2"></i>ä¸Šä¸€æ­¥
          </button>
          <button id="nextBtn"
            class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center">
            ä¸‹ä¸€æ­¥<i class="fa fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <!-- å³ä¾§JSONé¢„è§ˆåŒºåŸŸ -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24 z-30">
          <h3 class="text-xl font-bold mb-4 pb-2 border-b border-gray-100">JSONé…ç½®é¢„è§ˆ</h3>
          <div class="relative">
            <button id="copyJsonBtn"
              class="absolute top-2 right-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm transition-all">
              <i class="fa fa-copy mr-1"></i>å¤åˆ¶
            </button>
            <pre id="jsonPreview"
              class="bg-gray-50 p-4 rounded-lg text-sm overflow-x-auto max-h-[600px] font-mono"></pre>
          </div>
          <div id="copyAlert" class="mt-2 text-sm text-accent hidden">
            <i class="fa fa-check mr-1"></i>å·²å¤åˆ¶åˆ°å‰ªè´´æ¿
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-dark text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p>æ¾„åºè¯¾ç¨‹è¡¨é…ç½®ç”Ÿæˆå™¨</p>
      <p class="flex items-center justify-center mt-2">
        <a href="https://github.com/cyx200902/" target="_blank">
          <img src="https://img.shields.io/badge/Eason%20Chen-black?logo=github"
            style="vertical-align: middle; margin: 0 auto;">
        </a>
      </p>
      <p>Â© 2019-2025 WaterFlames.cn. All Rights Reserved.ï½œ<a href="https://beian.miit.gov.cn/">é—½ICPå¤‡2024035715å·-1</a>ï½œ<a
          href="https://www.12377.cn/">ä¸­å›½äº’è”ç½‘è¿æ³•å’Œä¸è‰¯ä¿¡æ¯ä¸¾æŠ¥ä¸­å¿ƒ</a></p>
    </div>
  </footer>

  <script>
    // å½“å‰æ­¥éª¤
    let currentStep = 0;
    const totalSteps = 5;

    // è·å–å½“å‰é¡¹ç›®å¼€å§‹æ—¶é—´ä½œä¸ºé»˜è®¤æ—¶é—´
    const now = new Date();
    const defaultHour = now.getHours().toString().padStart(2, '0');
    const defaultMinute = now.getMinutes().toString().padStart(2, '0');

    // ç”Ÿæˆå½“å‰æ—¶é—´çš„é»˜è®¤æ ¼å¼ (YYMMDDHHmmss)
    const getCurrentTimeString = () => {
      const date = new Date();
      const year = date.getFullYear().toString().slice(2);
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      const seconds = date.getSeconds().toString().padStart(2, '0');
      return `${year}${month}${day}${hours}${minutes}${seconds}`;
    };

    // åˆå§‹åŒ–æ•°æ®ç»“æ„
    let courseData = {
      basic: {
        dataStructureVersion: "1.1",
        dataSource: "official",
        name: "",
        createTime: getCurrentTimeString(),
        updateTime: getCurrentTimeString(),
        courseStart: "",
        courseEnd: ""
      },
      courses: [], // åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼Œä¸é»˜è®¤åˆ›å»ºè¯¾ç¨‹
      timetableTemplate: [
        // æ–°ç‰ˆæœ¬ä¸ä¼ ç©ºæ¨¡æ¿äº†ï¼Œä¼ -1
        // // ç©ºçš„æ— è¯¾ç¨‹æ¨¡æ¿ï¼ˆç´¢å¼•0ï¼‰
        // [
        //   {"type": "start"},
        //   {"type": "end"}
        // ]
      ],
      courseSchedule: [] // å°†é€šè¿‡JSåˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥
    };

    // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’ï¼ˆå›ºå®šé¡ºåºï¼‰
    const dayNames = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
    dayNames.forEach(() => {
      courseData.courseSchedule.push({
        timetableId: [-1], // æ–°ç‰ˆæœ¬é»˜è®¤ä¼ -1
        timetableRepeatability: 1,
        courseList: []
      });
    });

    // DOM å…ƒç´ 
    const step0 = document.getElementById('step0');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const jsonPreview = document.getElementById('jsonPreview');
    const copyJsonBtn = document.getElementById('copyJsonBtn');
    const copyAlert = document.getElementById('copyAlert');

    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const fileInput = document.getElementById('fileInput');

    // æ­¥éª¤æŒ‡ç¤ºå™¨
    const stepIndicators = [
      document.getElementById('step0Indicator'),
      document.getElementById('step1Indicator'),
      document.getElementById('step2Indicator'),
      document.getElementById('step3Indicator'),
      document.getElementById('step4Indicator')
    ];

    // è¿›åº¦æ¡
    const progressBars = [
      document.getElementById('progressBar0'),
      document.getElementById('progressBar1'),
      document.getElementById('progressBar2'),
      document.getElementById('progressBar3')
    ];

    // åˆå§‹åŒ–é¡µé¢
    function init() {
      // å…ˆåˆå§‹åŒ–å…¬å‘Šå¼¹çª—ï¼Œå†æ‰§è¡ŒåŸé¡µé¢åˆå§‹åŒ–
      initAnnouncementModal();

      // è®¾ç½®åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´çš„é»˜è®¤å€¼
      document.getElementById('createTime').value = courseData.basic.createTime;
      document.getElementById('updateTime').value = courseData.basic.updateTime;

      updateStepUI();
      updateJsonPreview();
      setupEventListeners();

      // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’UIï¼ˆå›ºå®šé¡ºåºï¼‰
      initWeekDaysSchedule();
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // æ­¥éª¤å¯¼èˆª
      prevBtn.addEventListener('click', goToPrevStep);
      nextBtn.addEventListener('click', goToNextStep);
      // æ–°å»ºè¯¾è¡¨å…¶å®ä¹Ÿæ˜¯ä¸‹ä¸€æ­¥
      NewBtn.addEventListener('click', goToNextStep);

      // å¤åˆ¶JSON
      copyJsonBtn.addEventListener('click', copyJsonToClipboard);

      // ä¿å­˜å’ŒåŠ è½½é…ç½®
      saveBtn.addEventListener('click', saveConfiguration);
      loadBtn.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', loadConfiguration);

      // åŸºç¡€ä¿¡æ¯è¾“å…¥å˜åŒ–
      document.getElementById('dataStructureVersion').addEventListener('input', updateBasicInfo);
      document.getElementById('name').addEventListener('input', updateBasicInfo);
      document.getElementById('createTime').addEventListener('input', updateBasicInfo);
      document.getElementById('updateTime').addEventListener('input', updateBasicInfo);
      document.getElementById('courseStart').addEventListener('input', updateBasicInfo);
      document.getElementById('courseEnd').addEventListener('input', updateBasicInfo);

      // è¯¾ç¨‹ç®¡ç†
      document.getElementById('addCourseBtn').addEventListener('click', addCourse);
      document.getElementById('coursesContainer').addEventListener('click', handleCourseActions);
      document.getElementById('coursesContainer').addEventListener('input', updateCourseInfo);

      // æ—¶é—´è¡¨æ¨¡æ¿ç®¡ç†
      document.getElementById('addTemplateBtn').addEventListener('click', addTemplate);
      document.getElementById('templatesContainer').addEventListener('click', handleTemplateActions);
      document.getElementById('templatesContainer').addEventListener('change', updateTemplateInfo);

      // è¯¾ç¨‹å®‰æ’ç®¡ç†
      document.getElementById('scheduleContainer').addEventListener('change', handleScheduleChange);
      document.getElementById('scheduleContainer').addEventListener('click', function (e) {
        // å¤„ç†æ·»åŠ è¯¾ç¨‹æŒ‰é’®ç‚¹å‡»
        if (e.target.closest('.add-course-to-schedule')) {
          const btn = e.target.closest('.add-course-to-schedule');
          if (!btn.disabled) {
            handleAddCourseToSchedule(e);
          }
          return;
        }

        // å¤„ç†åˆ é™¤è¯¾ç¨‹æŒ‰é’®ç‚¹å‡»
        if (e.target.closest('.delete-course-item')) {
          handleDeleteCourseFromSchedule(e);
          return;
        }
      });
      document.getElementById('scheduleContainer').addEventListener('input', updateScheduleInfo);
    }

    // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’UIï¼ˆå›ºå®šé¡ºåºï¼‰
    function initWeekDaysSchedule() {
      const scheduleContainer = document.getElementById('scheduleContainer');
      scheduleContainer.innerHTML = '';

      // ä¸¥æ ¼æŒ‰ç…§å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåºæ·»åŠ 
      dayNames.forEach((dayName, index) => {
        // åˆ›å»ºæ¯ä¸€å¤©çš„å®¹å™¨å¹¶ä¿ç•™åœ¨DOMä¸­
        const dayContainer = document.createElement('div');
        dayContainer.id = `dayContainer-${index}`;
        scheduleContainer.appendChild(dayContainer);

        // æ¸²æŸ“å½“å¤©å†…å®¹
        renderDayContent(index, dayName);
      });
    }

    // æ¸²æŸ“ç‰¹å®šå¤©çš„å†…å®¹
    function renderDayContent(dayIndex, dayName) {
      const dayContainer = document.getElementById(`dayContainer-${dayIndex}`);
      if (!dayContainer) return;

      const dayData = courseData.courseSchedule[dayIndex];

      // ç”Ÿæˆæ—¶é—´è¡¨æ¨¡æ¿ä¸‹æ‹‰é€‰é¡¹
      let timetableOptions = '<option value="-1" >ä»Šæ—¥æ— è¯¾</option>';
      courseData.timetableTemplate.forEach((_, i) => {
        timetableOptions += `<option value="${i}" ${dayData.timetableId[0] === i ? 'selected' : ''}>æ¨¡æ¿ #${i + 1}</option>`;
      });


      // ç”Ÿæˆè¯¾ç¨‹ä¸‹æ‹‰é€‰é¡¹
      let courseOptions = '<option value="">é€‰æ‹©è¯¾ç¨‹</option>';
      courseData.courses.forEach((course, i) => {
        const courseName = course.courseName || `è¯¾ç¨‹ #${i + 1}`;
        courseOptions += `<option value="${i}">${courseName}</option>`;
      });

      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ— è¯¾ç¨‹æ¨¡æ¿
      const isNoCourseTemplate = dayData.timetableId[0] === -1;

      dayContainer.innerHTML = `
        <div class="day-card bg-neutral rounded-lg p-4 card-hover">
          <div class="flex justify-between items-start mb-4">
            <h4 class="font-medium">${dayName}</h4>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">æ—¶é—´è¡¨æ¨¡æ¿</label>
              <select class="timetable-id w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus">
                ${timetableOptions}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">æ¨¡æ¿é‡å¤æ¬¡æ•°</label>
              <input type="number" min="1" class="timetable-repeatability w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                    value="${dayData.timetableRepeatability || 1}">
            </div>
          </div>
          
          <div class="mb-4">
            <div class="flex justify-between items-center mb-3">
              <h5 class="font-medium">è¯¾ç¨‹åˆ—è¡¨</h5>
              <button class="add-course-to-schedule bg-accent hover:bg-accent/90 text-white px-3 py-1 rounded transition-all text-sm flex items-center ${isNoCourseTemplate ? 'opacity-50 cursor-not-allowed' : ''}"
                      ${isNoCourseTemplate ? 'disabled' : ''}>
                <i class="fa fa-plus mr-1"></i>æ·»åŠ è¯¾ç¨‹
              </button>
            </div>
            
            ${isNoCourseTemplate ? '<p class="no-course-message text-gray-500 italic mb-3">å½“æ—¥æ— è¯¾ç¨‹</p>' : ''}
            
            <div class="course-list space-y-3" data-day-index="${dayIndex}">
              ${dayData.courseList.map((courseItem, itemIndex) => `
                <div class="course-item bg-white rounded p-3 border border-gray-200 flex flex-col md:flex-row gap-3">
                  <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯¾ç¨‹</label>
                    <select class="course-id w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" ${isNoCourseTemplate ? 'disabled' : ''}>
                      ${courseOptions}
                    </select>
                  </div>
                  <div class="w-full md:w-32">
                    <label class="block text-sm font-medium text-gray-700 mb-1">é‡å¤æ¬¡æ•°</label>
                    <input type="number" min="1" class="course-repeatability w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                          value="${courseItem.courseRepeatability || 1}" ${isNoCourseTemplate ? 'disabled' : ''}>
                  </div>
                  <div class="flex items-end">
                    <button class="delete-course-item text-red-500 hover:text-red-700 transition-colors p-2 ${isNoCourseTemplate ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${isNoCourseTemplate ? 'disabled' : ''}>
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      // è®¾ç½®å·²é€‰æ‹©çš„è¯¾ç¨‹
      const courseItems = dayContainer.querySelectorAll('.course-item');
      courseItems.forEach((item, itemIndex) => {
        const courseId = dayData.courseList[itemIndex]?.courseId?.[0];
        if (courseId !== undefined) {
          const select = item.querySelector('.course-id');
          select.value = courseId;
        }
      });
    }

    // æ›´æ–°æ­¥éª¤UI
    function updateStepUI() {
      // éšè—æ‰€æœ‰æ­¥éª¤
      step0.classList.add('hidden');
      step1.classList.add('hidden');
      step2.classList.add('hidden');
      step3.classList.add('hidden');
      step4.classList.add('hidden');

      // æ˜¾ç¤ºå½“å‰æ­¥éª¤
      switch (currentStep) {
        case 0:
          step0.classList.remove('hidden');
          prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = true;
          nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = true;
          break;
        case 1:
          step1.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 2:
          step2.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 3:
          step3.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 4:
          step4.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = true;
          break;
      }

      // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
      stepIndicators.forEach((indicator, index) => {
        indicator.classList.remove('step-active', 'step-completed', 'step-pending');
        if (index < currentStep) {
          indicator.classList.add('step-completed');
        } else if (index === currentStep) {
          indicator.classList.add('step-active');
        } else {
          indicator.classList.add('step-pending');
        }
      });

      // æ›´æ–°è¿›åº¦æ¡
      progressBars.forEach((bar, index) => {
        bar.style.width = (index < currentStep) ? '100%' : '0%';
      });

      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ä¸Šä¸€æ­¥
    function goToPrevStep() {
      if (currentStep > 0) {
        currentStep--;
        console.log(currentStep)
        updateStepUI();
        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        nextBtn.disabled = false;
      }
      if (currentStep == 0) {
        NewBtn.classList.add('opacity-50', 'cursor-not-allowed');
        NewBtn.disabled = true;
      }
    }

    // ä¸‹ä¸€æ­¥
    function goToNextStep() {
      if (currentStep < totalSteps) {
        // å½“ä»æ­¥éª¤3åˆ°æ­¥éª¤4æ—¶ï¼Œæ›´æ–°è¯¾ç¨‹å®‰æ’çš„ä¸‹æ‹‰é€‰é¡¹
        if (currentStep === 3) {
          updateAllScheduleDropdowns();
        }
        currentStep++;
        console.log(currentStep)
        updateStepUI();
      }
    }

    // æ›´æ–°JSONé¢„è§ˆ
    function updateJsonPreview() {
      jsonPreview.textContent = JSON.stringify(courseData, null, 2);
    }

    // å¤åˆ¶JSONåˆ°å‰ªè´´æ¿
    function copyJsonToClipboard() {
      navigator.clipboard.writeText(jsonPreview.textContent).then(() => {
        copyAlert.classList.remove('hidden');
        setTimeout(() => {
          copyAlert.classList.add('hidden');
        }, 2000);
      });
    }

    // ä¿å­˜é…ç½®
    function saveConfiguration() {
      // ä¿å­˜å‰æ›´æ–°ä¿®æ”¹æ—¶é—´
      courseData.basic.updateTime = getCurrentTimeString();
      document.getElementById('updateTime').value = courseData.basic.updateTime;

      const jsonStr = JSON.stringify(courseData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = courseData.basic.name ? `${courseData.basic.name}.json` : 'courseData.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      updateJsonPreview();
    }





    /*ä»¥ä¸‹ä¸ºwakeupæ•°æ®è½¬æ¢*/


    /**
     * è¯¾è¡¨æ•°æ®æå–å·¥å…· - é‡æ„ç‰ˆ
     * åŠŸèƒ½ï¼šè¯»å–æŒ‡å®šè¯¾è¡¨æ–‡ä»¶ï¼Œæå–è¯¾ç¨‹è¡¨åŸºæœ¬æ•°æ®å’Œè¯¾ç¨‹åˆ—è¡¨ï¼Œå¹¶ç”Ÿæˆæ ‡å‡†æ ¼å¼çš„JSONæ–‡ä»¶
     * è¯´æ˜ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½åœ¨ä¸»å‡½æ•°ä¸­å®ç°
     * é‡æ„è¯´æ˜ï¼šæŒ‰ç…§æ–°çš„æ•°æ®è§£æé€»è¾‘ï¼Œå°†æºæ•°æ®æŒ‰è¡Œåˆ†å‰²ä¸ºå¤šä¸ªJSONå¯¹è±¡
     */

    // ========== å¼•å…¥æ¨¡å— ==========
    // const fs = require('fs');
    // const path = require('path');

    // ========== ä¸»å¤„ç†å‡½æ•° ==========
    /**
     * è¯¾è¡¨æ•°æ®æå–ä¸»å‡½æ•° - é‡æ„ç‰ˆ
     * è¯»å–æŒ‡å®šè¯¾è¡¨æ–‡ä»¶ï¼Œå°†æºæ•°æ®æŒ‰è¡Œåˆ†å‰²ä¸ºå¤šä¸ªJSONå¯¹è±¡ï¼Œå¹¶ç”Ÿæˆæ ‡å‡†æ ¼å¼çš„JSONæ–‡ä»¶
     * @param {string} fileContentInput - æºæ–‡ä»¶å†…å®¹
     * @returns {object} æå–åçš„è¯¾ç¨‹æ•°æ®å¯¹è±¡
     */
    function extractCourseData(fileContentInput) {

      try {
        // è¯»å–æºæ–‡ä»¶å†…å®¹
        const fileContent = fileContentInput;
        
        // ========== æ•°æ®è§£æéƒ¨åˆ† - é‡æ„ç‰ˆ ==========
        // å°†æ–‡ä»¶å†…å®¹æŒ‰è¡Œåˆ†å‰²
        const lines = fileContent.trim().split('\n');
        
        // è§£ææ¯ä¸€è¡Œçš„JSONæ•°æ®
        const jsonData = lines.map(line => {
          try {
            return JSON.parse(line);
          } catch (e) {
            console.error(`è§£æJSONè¡Œå¤±è´¥: ${line}`);
            return null;
          }
        }).filter(item => item !== null);
        
        // åˆå§‹åŒ–å˜é‡å­˜å‚¨è§£æåçš„æ•°æ®
        let basicInfo = {};          // å­˜å‚¨åŸºæœ¬ä¿¡æ¯ï¼ˆæ¥è‡ª2å·å…ƒç´ ï¼‰
        let coursesInfoArray = [];   // å­˜å‚¨è¯¾ç¨‹åç§°ä¿¡æ¯ï¼ˆæ¥è‡ª3å·å…ƒç´ ï¼‰
        let courseDetailsArray = []; // å­˜å‚¨æ•™å®¤å’Œæ•™å¸ˆä¿¡æ¯ï¼ˆæ¥è‡ª4å·å…ƒç´ ï¼‰
        let timeDataArray = [];      // å­˜å‚¨æ—¶é—´ä¿¡æ¯ï¼ˆæ¥è‡ª1å·å…ƒç´ ï¼‰
        let courseScheduleArray = []; // å­˜å‚¨è¯¾ç¨‹å®‰æ’ä¿¡æ¯ï¼ˆæ¥è‡ª4å·å…ƒç´ ï¼‰
        
        try {
          // æ£€æŸ¥æ•°æ®é•¿åº¦æ˜¯å¦è¶³å¤Ÿ
          if (jsonData.length < 5) {
            throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè‡³å°‘éœ€è¦5ä¸ªJSONå¯¹è±¡');
          }
          
          // ========== æå–å„éƒ¨åˆ†æ•°æ® ==========
          // 1. æ—¶é—´æ•°æ®æ•°ç»„æ¥è‡ª1å·å…ƒç´ ï¼ˆç´¢å¼•1ï¼‰
          if (Array.isArray(jsonData[1])) {
            timeDataArray = jsonData[1];
            console.log('æˆåŠŸæå–æ—¶é—´æ•°æ®æ•°ç»„ï¼Œé•¿åº¦:', timeDataArray.length);
          } else {
            throw new Error('1å·å…ƒç´ ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');
          }
          
          // 2. åŸºæœ¬ä¿¡æ¯ï¼ˆtableNameã€courseStartã€courseEndï¼‰æ¥è‡ª2å·å…ƒç´ ï¼ˆç´¢å¼•2ï¼‰
          if (typeof jsonData[2] === 'object' && jsonData[2] !== null) {
            basicInfo = jsonData[2];
            console.log('æˆåŠŸæå–åŸºæœ¬ä¿¡æ¯:', basicInfo.tableName);
          } else {
            throw new Error('2å·å…ƒç´ ä¸æ˜¯æœ‰æ•ˆçš„å¯¹è±¡æ ¼å¼');
          }
          
          // 3. è¯¾ç¨‹åç§°ä¿¡æ¯ï¼ˆcourseNameï¼‰æ¥è‡ª3å·å…ƒç´ ï¼ˆç´¢å¼•3ï¼‰
          if (Array.isArray(jsonData[3])) {
            coursesInfoArray = jsonData[3];
            console.log('æˆåŠŸæå–è¯¾ç¨‹åç§°ä¿¡æ¯æ•°ç»„ï¼Œé•¿åº¦:', coursesInfoArray.length);
          } else {
            throw new Error('3å·å…ƒç´ ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');
          }
          
          // 4. æ•™å®¤å’Œæ•™å¸ˆä¿¡æ¯ï¼ˆroomã€teacherï¼‰æ¥è‡ª4å·å…ƒç´ ï¼ˆç´¢å¼•4ï¼‰
          // 5. è¯¾ç¨‹å®‰æ’æ•°ç»„æ¥è‡ª4å·å…ƒç´ ï¼ˆç´¢å¼•4ï¼‰
          if (Array.isArray(jsonData[4])) {
            courseDetailsArray = jsonData[4];
            courseScheduleArray = jsonData[4];
            console.log('æˆåŠŸæå–è¯¾ç¨‹è¯¦æƒ…å’Œè¯¾ç¨‹å®‰æ’æ•°ç»„ï¼Œé•¿åº¦:', courseDetailsArray.length);
          } else {
            throw new Error('4å·å…ƒç´ ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');
          }
          
          // æ·»åŠ è°ƒè¯•ä¿¡æ¯
          console.log(`è§£æåˆ°çš„æ•°æ®ï¼š`);
          console.log(`- æ—¶é—´æ•°æ®æ•°ç»„é•¿åº¦: ${timeDataArray.length}`);
          console.log(`- åŸºæœ¬ä¿¡æ¯: ${JSON.stringify(basicInfo)}`);
          console.log(`- è¯¾ç¨‹åç§°ä¿¡æ¯æ•°ç»„é•¿åº¦: ${coursesInfoArray.length}`);
          console.log(`- è¯¾ç¨‹è¯¦æƒ…æ•°ç»„é•¿åº¦: ${courseDetailsArray.length}`);
          console.log(`- è¯¾ç¨‹å®‰æ’æ•°ç»„é•¿åº¦: ${courseScheduleArray.length}`);
          
        } catch (parseError) {
          console.error('è§£ææ–‡ä»¶å¤±è´¥:', parseError);
          return;
        }
        
        // æå–åŸºæœ¬ä¿¡æ¯
        const tableName = basicInfo.tableName || '';
        const startDate = basicInfo.startDate || '';
        const maxWeek = basicInfo.maxWeek || 0;
        
        // ========== è¯¾ç¨‹æ•°æ®å¤„ç†éƒ¨åˆ† ==========
        // åˆ›å»ºè¯¾ç¨‹ä¿¡æ¯æ˜ å°„ (id -> courseName)
        const courseNameMap = new Map();
        coursesInfoArray.forEach(course => {
          if (course.id !== undefined && course.courseName) {
            courseNameMap.set(course.id, course.courseName);
          }
        });
        
        // åˆ›å»ºè¯¾ç¨‹è¯¦æƒ…æ˜ å°„ (id -> {teacher, room})
        const courseDetailsMap = new Map();
        courseDetailsArray.forEach(detail => {
          if (detail.id !== undefined) {
            courseDetailsMap.set(detail.id, {
              teacher: detail.teacher || '',
              room: detail.room || detail.classroom || '' // åŒæ—¶æ”¯æŒroomå’Œclassroomå­—æ®µ
            });
          }
        });
        
        // åˆå§‹åŒ–æ›´æ–°åçš„è¯¾ç¨‹å®‰æ’æ•°ç»„
        let updatedCourseScheduleArray = [];
        
        // ä»¥"teacher"å’Œ"room"å­—æ®µä½œä¸ºæ ¸å¿ƒé©±åŠ¨è¦ç´ ï¼Œå¤„ç†è¯¾ç¨‹IDå†²çª
        // åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œç”¨äºå­˜å‚¨teacher+roomç»„åˆåˆ°è¯¾ç¨‹IDçš„æ˜ å°„
        const teacherRoomToIdMap = new Map();
        // å­˜å‚¨å·²ä½¿ç”¨çš„IDï¼Œç”¨äºåˆ†é…æ–°ID
        const usedIds = new Set();
        // å­˜å‚¨IDæ˜ å°„å…³ç³»ï¼Œç”¨äºåç»­æ›´æ–°è¯¾ç¨‹å®‰æ’ä¸­çš„ID
        const idMapping = new Map();
        
        // é¦–å…ˆæ”¶é›†æ‰€æœ‰å·²ä½¿ç”¨çš„ID
        coursesInfoArray.forEach(course => {
          if (course.id !== undefined) {
            usedIds.add(course.id);
          }
        });
        
        // å¤„ç†è¯¾ç¨‹è¯¦ç»†ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªteacher+roomç»„åˆåˆ†é…å”¯ä¸€ID
        const processedCourses = [];
        
        // é¦–å…ˆå¤„ç†è¯¾ç¨‹å®‰æ’æ•°ç»„ï¼Œç¡®ä¿æ¯ä¸ªè¯¾ç¨‹å®‰æ’éƒ½æœ‰æ­£ç¡®çš„IDæ˜ å°„
        updatedCourseScheduleArray = courseScheduleArray.map(schedule => {
          // è·å–è¯¾ç¨‹åç§°å’Œè¯¦ç»†ä¿¡æ¯
          const courseName = courseNameMap.get(schedule.id) || '';
          const courseDetail = courseDetailsMap.get(schedule.id) || { teacher: '', room: '' };
          
          // åˆ›å»ºteacher+roomç»„åˆçš„å”¯ä¸€æ ‡è¯†
          const teacherRoomKey = `${courseDetail.teacher}_${courseDetail.room}`;
          
          let courseId = schedule.id;
          
          // æ£€æŸ¥åŸå§‹IDæ˜¯å¦æœ‰æ•ˆï¼ˆé0ä¸”åœ¨è¯¾ç¨‹ä¿¡æ¯æ•°ç»„ä¸­å­˜åœ¨ï¼‰
          const isValidOriginalId = schedule.id !== 0 && coursesInfoArray.some(course => course.id === schedule.id);
          
          if (isValidOriginalId) {
            // å¦‚æœåŸå§‹IDæœ‰æ•ˆï¼Œæ‰¾åˆ°è¯¥è¯¾ç¨‹åœ¨coursesInfoArrayä¸­çš„ç´¢å¼•ä½œä¸ºcourseId
            const courseIndex = coursesInfoArray.findIndex(course => course.id === schedule.id);
            courseId = courseIndex; // ä½¿ç”¨æ•°ç»„ç´¢å¼•ä½œä¸ºcourseId
          } else {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„teacher+roomç»„åˆ
            if (teacherRoomToIdMap.has(teacherRoomKey)) {
              // å¦‚æœå·²å­˜åœ¨ï¼Œä½¿ç”¨å·²åˆ†é…çš„ID
              courseId = teacherRoomToIdMap.get(teacherRoomKey);
            } else {
              // æ£€æŸ¥è¯¥IDæ˜¯å¦å·²è¢«å…¶ä»–teacher+roomç»„åˆä½¿ç”¨
              let isIdConflict = false;
              for (const [key, existingId] of teacherRoomToIdMap.entries()) {
                if (existingId === courseId && key !== teacherRoomKey) {
                  isIdConflict = true;
                  break;
                }
              }
              
              // å¦‚æœå­˜åœ¨IDå†²çªï¼Œåˆ†é…ä¸€ä¸ªæ–°çš„ID
              if (isIdConflict) {
                // æ‰¾åˆ°æœ€å°çš„æœªä½¿ç”¨ID
                let newId = 0;
                while (usedIds.has(newId)) {
                  newId++;
                }
                courseId = newId;
                usedIds.add(courseId);
              }
              
              // å­˜å‚¨teacher+roomç»„åˆåˆ°IDçš„æ˜ å°„
              teacherRoomToIdMap.set(teacherRoomKey, courseId);
            }
          }
          
          // å­˜å‚¨IDæ˜ å°„å…³ç³»ï¼ˆåŸå§‹ID -> æ–°IDï¼‰
          if (schedule.id !== courseId) {
            idMapping.set(schedule.id, courseId);
          }
          
          // æ·»åŠ å¤„ç†åçš„è¯¾ç¨‹
          if (!processedCourses.some(c => c.id === courseId && c.courseName === courseName)) {
            processedCourses.push({
              id: courseId,
              courseName: courseName,
              teacher: courseDetail.teacher,
              classroom: courseDetail.room
            });
          }
          
          // è¿”å›æ›´æ–°åçš„è¯¾ç¨‹å®‰æ’ï¼Œä¿ç•™åŸå§‹è¯¾ç¨‹åç§°ä¿¡æ¯
          return {
            ...schedule,
            id: courseId,
            courseName: courseName
          };
        });
        
        // å»é‡ï¼ˆåŸºäºteacher+roomç»„åˆå·²ç»ç¡®ä¿äº†å”¯ä¸€æ€§ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç¡®ä¿æ²¡æœ‰å®Œå…¨é‡å¤çš„æ¡ç›®ï¼‰
        const uniqueCourses = [];
        const seenCourseIdentifiers = new Set();
        processedCourses.forEach(course => {
          // åˆ›å»ºè¯¾ç¨‹å”¯ä¸€æ ‡è¯†ï¼ˆç»„åˆcourseNameã€teacherå’Œclassroomï¼‰
          const courseIdentifier = `${course.courseName}_${course.teacher}_${course.classroom}`;
          if (!seenCourseIdentifiers.has(courseIdentifier)) {
            seenCourseIdentifiers.add(courseIdentifier);
            uniqueCourses.push(course);
          }
        });
        
        // å…ˆæŒ‰IDæ’åº
        uniqueCourses.sort((a, b) => a.id - b.id);

        // é‡æ–°åˆ†é…IDï¼Œç¡®ä¿IDä¸æœ€ç»ˆåˆ—è¡¨ä¸­çš„ç´¢å¼•ä¸€è‡´
        const idToIndexMap = new Map();
        uniqueCourses.forEach((course, index) => {
          idToIndexMap.set(course.id, index);
          course.id = index; // æ›´æ–°IDä¸ºç´¢å¼•å€¼
        });
        
        // æ›´æ–°è¯¾ç¨‹å®‰æ’ä¸­çš„IDå¼•ç”¨
        updatedCourseScheduleArray.forEach(schedule => {
          if (idToIndexMap.has(schedule.id)) {
            schedule.id = idToIndexMap.get(schedule.id);
          }
        });
        
        // ç§»é™¤IDå­—æ®µ
        const finalCourses = uniqueCourses.map(({id, ...rest}) => rest);
        
        // æ·»åŠ è°ƒè¯•ä¿¡æ¯
        console.log(`æ›´æ–°åçš„è¯¾ç¨‹å®‰æ’æ•°ç»„é•¿åº¦: ${updatedCourseScheduleArray.length}`);
        
        if (tableName && startDate && maxWeek) {
          // ========== æ—¥æœŸå¤„ç†éƒ¨åˆ† ==========
          // æ ¼å¼åŒ–æ—¥æœŸä¸ºyyMMddæ ¼å¼
          const parts = startDate.split('-');
          const year = parts[0].slice(2); // å–å¹´ä»½åä¸¤ä½
          const month = parts[1].padStart(2, '0'); // æœˆä»½è¡¥é›¶
          const day = parts[2].padStart(2, '0'); // æ—¥æœŸè¡¥é›¶
          const courseStart = `${year}${month}${day}`;
          
          // è®¡ç®—æ—¥æœŸåŠ ä¸ŠæŒ‡å®šå‘¨æ•°åçš„æ—¥æœŸ
          const dateParts = startDate.split('-');
          const date = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
          date.setDate(date.getDate() + maxWeek * 7);
          
          const endYear = date.getFullYear().toString().slice(2);
          const endMonth = (date.getMonth() + 1).toString().padStart(2, '0');
          const endDay = date.getDate().toString().padStart(2, '0');
          
          const courseEnd = `${endYear}${endMonth}${endDay}`;
          
          // ========== æ—¶é—´è¡¨æ¨¡æ¿ç”Ÿæˆéƒ¨åˆ† ==========
          // è·å–æ‰€æœ‰ä¸åŒçš„dayå€¼ï¼ŒåŒ…æ‹¬1-7å¤©
          const uniqueDays = [...new Set(updatedCourseScheduleArray.map(item => item.day))].sort((a, b) => a - b);
          
          let timetableTemplates = [];
          // ç”¨äºå­˜å‚¨æ¨¡æ¿å’Œå…¶ç´¢å¼•çš„æ˜ å°„
          const templateMap = new Map();
          // å­˜å‚¨æ¯ä¸ªdayå¯¹åº”çš„æ¨¡æ¿ç´¢å¼•
          const dayTemplateIndexMap = new Map();
          
          // ä¸ºæ¯ä¸ªdayç”ŸæˆtimetableTemplate
          uniqueDays.forEach(day => {
            const dayTemplate = [{ type: 'start' }];
            
            // è·å–è¯¥dayçš„æ‰€æœ‰è¯¾ç¨‹å®‰æ’ï¼Œä½¿ç”¨æ›´æ–°åçš„è¯¾ç¨‹å®‰æ’æ•°ç»„
            const dayCourses = updatedCourseScheduleArray.filter(item => item.day === day);
            
            // æ”¶é›†æ‰€æœ‰æ—¶é—´èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬courseå’Œintervalï¼‰
            const timeNodes = [];
            
            // ä¸ºæ¯ä¸ªè¯¾ç¨‹å®‰æ’ç”Ÿæˆæ—¶é—´èŠ‚ç‚¹
            dayCourses.forEach(course => {
              // æ ¹æ®startNodeè·å–å¯¹åº”çš„startTime
              const timeItem = timeDataArray.find(item => item.node === course.startNode);
              if (timeItem && timeItem.startTime !== '00:00') {
                const startTimeParts = timeItem.startTime.split(':');
                // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒæ—¶é—´çš„courseèŠ‚ç‚¹
                const existingCourseNode = timeNodes.find(node => 
                  node.type === 'course' && 
                  node.timeHour === startTimeParts[0] && 
                  node.timeMinute === startTimeParts[1]
                );
                
                // æ€»æ˜¯æ·»åŠ courseèŠ‚ç‚¹ï¼Œå³ä½¿æ—¶é—´ç›¸åŒ
                timeNodes.push({
                  type: 'course',
                  timeHour: startTimeParts[0],
                  timeMinute: startTimeParts[1],
                  time: parseInt(startTimeParts[0]) * 60 + parseInt(startTimeParts[1]) // è½¬æ¢ä¸ºåˆ†é’Ÿæ•°ç”¨äºæ’åº
                });
                
                // æ ¹æ®stepç¡®å®šç»“æŸæ—¶é—´ç‚¹
                const endNode = course.startNode + course.step - 1;
                const endTimeItem = timeDataArray.find(item => item.node === endNode);
                if (endTimeItem && endTimeItem.endTime !== '00:00') {
                  const endTimeParts = endTimeItem.endTime.split(':');
                  // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒæ—¶é—´çš„intervalèŠ‚ç‚¹
                  const existingIntervalNode = timeNodes.find(node => 
                    node.type === 'interval' && 
                    node.timeHour === endTimeParts[0] && 
                    node.timeMinute === endTimeParts[1]
                  );
                  
                  // æ€»æ˜¯æ·»åŠ intervalèŠ‚ç‚¹ï¼Œå³ä½¿æ—¶é—´ç›¸åŒ
                  timeNodes.push({
                    type: 'interval',
                    timeHour: endTimeParts[0],
                    timeMinute: endTimeParts[1],
                    time: parseInt(endTimeParts[0]) * 60 + parseInt(endTimeParts[1]) // è½¬æ¢ä¸ºåˆ†é’Ÿæ•°ç”¨äºæ’åº
                  });
                }
              }
            });
            
            // æŒ‰æ—¶é—´æ’åºæ‰€æœ‰èŠ‚ç‚¹
            timeNodes.sort((a, b) => {
              if (a.time !== b.time) {
                return a.time - b.time;
              }
              // å¦‚æœæ—¶é—´ç›¸åŒï¼ŒcourseèŠ‚ç‚¹åº”è¯¥åœ¨intervalèŠ‚ç‚¹ä¹‹å‰
              if (a.type === 'course' && b.type === 'interval') {
                return -1;
              }
              if (a.type === 'interval' && b.type === 'course') {
                return 1;
              }
              // å¦‚æœç±»å‹ç›¸åŒï¼Œä¿æŒåŸæœ‰é¡ºåº
              return 0;
            });
            
            // å½“ä¸Šä¸€ä¸ª"interval"èŠ‚ç‚¹ä¸ä¸‹ä¸€ä¸ª"course"èŠ‚ç‚¹ä¹‹é—´çš„æ—¶é—´å·®è¶…è¿‡ä¸€å°æ—¶æ—¶ï¼Œå°±æŠŠè¯¥"interval"èŠ‚ç‚¹æ›¿æ¢æˆ"rest"èŠ‚ç‚¹
            for (let i = 0; i < timeNodes.length - 1; i++) {
              // æ£€æŸ¥å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºintervalç±»å‹ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºcourseç±»å‹
              if (timeNodes[i].type === 'interval' && timeNodes[i + 1].type === 'course') {
                // è®¡ç®—æ—¶é—´å·®ï¼ˆåˆ†é’Ÿï¼‰
                const timeDiff = timeNodes[i + 1].time - timeNodes[i].time;
                // å¦‚æœæ—¶é—´å·®è¶…è¿‡60åˆ†é’Ÿï¼ˆ1å°æ—¶ï¼‰
                if (timeDiff > 60) {
                  // å°†intervalèŠ‚ç‚¹æ›¿æ¢ä¸ºrestèŠ‚ç‚¹ï¼Œæ—¶é—´ä¿æŒä¸å˜
                  timeNodes[i].type = 'rest';
                }
              }
            }
            
            // å°†æ’åºåçš„èŠ‚ç‚¹æ·»åŠ åˆ°dayTemplateä¸­
            timeNodes.forEach(node => {
              // ç§»é™¤ç”¨äºæ’åºçš„timeå±æ€§
              const { time, ...nodeWithoutTime } = node;
              dayTemplate.push(nodeWithoutTime);
            });
            
            // æ·»åŠ endèŠ‚ç‚¹
            if (dayTemplate.length > 1) {
              // ç§»é™¤æœ€åä¸€ä¸ªintervalèŠ‚ç‚¹
              const lastInterval = dayTemplate.pop();
              // ä½¿ç”¨æœ€åä¸€ä¸ªintervalèŠ‚ç‚¹çš„æ—¶é—´ä½œä¸ºendèŠ‚ç‚¹çš„æ—¶é—´
              dayTemplate.push({
                type: 'end',
                timeHour: lastInterval.timeHour,
                timeMinute: lastInterval.timeMinute
              });
            }
            
            // å°†æ¨¡æ¿è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç”¨äºæ¯”è¾ƒ
            const templateStr = JSON.stringify(dayTemplate);
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„æ¨¡æ¿
            if (templateMap.has(templateStr)) {
              // å¦‚æœå·²å­˜åœ¨ï¼Œè®°å½•è¯¥dayå¯¹åº”çš„æ¨¡æ¿ç´¢å¼•
              dayTemplateIndexMap.set(day, templateMap.get(templateStr));
            } else {
              // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°æ¨¡æ¿
              const newIndex = timetableTemplates.length;
              timetableTemplates.push(dayTemplate);
              templateMap.set(templateStr, newIndex);
              dayTemplateIndexMap.set(day, newIndex);
            }
          });
          
          // ========== è¯¾ç¨‹å®‰æ’ç”Ÿæˆéƒ¨åˆ† ==========
          // ä¸ºä¸€å‘¨ä¸­çš„æ¯ä¸€å¤©ï¼ˆ1-7ï¼‰ç”ŸæˆcourseScheduleæ¡ç›®
          let courseSchedule = [];
          // å¤„ç†ä¸€å‘¨ä¸­çš„æ‰€æœ‰å¤©æ•°ï¼ˆ1-7ï¼‰ï¼Œç¡®ä¿æ¯å¤©éƒ½æœ‰å¯¹åº”çš„æ¡ç›®
          for (let day = 1; day <= 7; day++) {
            // ä½¿ç”¨æ›´æ–°åçš„è¯¾ç¨‹å®‰æ’æ•°ç»„ï¼Œç¡®ä¿IDä¸€è‡´æ€§
            const dayCourses = updatedCourseScheduleArray.filter(item => item.day === day);
            
            // åˆ¤æ–­å½“å¤©æ˜¯å¦æœ‰è¯¾ç¨‹å®‰æ’
            if (dayCourses.length > 0) {
              // æœ‰è¯¾ç¨‹å®‰æ’çš„å¤©æ•°ï¼Œæ­£å¸¸å¤„ç†
              // å…ˆæŒ‰ç…§startNodeå¯¹è¯¾ç¨‹è¿›è¡Œæ’åº
              const sortedDayCourses = dayCourses.sort((a, b) => a.startNode - b.startNode);
              
              // åˆ›å»ºcourseListæ•°ç»„ï¼Œä¿ç•™åŒä¸€å¤©çš„æ‰€æœ‰è¯¾ç¨‹
              const courseList = sortedDayCourses.map(course => {
                // ç›´æ¥ä½¿ç”¨å·²ç»æ­£ç¡®æ˜ å°„çš„course.id
                const courseId = course.id;
                
                return {
                  courseId: [courseId],
                  courseRepeatability: 1
                };
              });
              
              // æ·»åŠ åˆ°courseScheduleï¼Œä½¿ç”¨å»é‡åçš„æ¨¡æ¿ç´¢å¼•
              courseSchedule.push({
                timetableId: [dayTemplateIndexMap.get(day)],
                timetableRepeatability: 1,
                courseList: courseList
              });
            } else {
              // æ²¡æœ‰è¯¾ç¨‹å®‰æ’çš„å¤©æ•°ï¼Œå°†timetableIdè®¾ä¸º-1ï¼ŒcourseListä¸ºç©ºæ•°ç»„
              courseSchedule.push({
                timetableId: [-1],
                timetableRepeatability: 1,
                courseList: []
              });
            }
          }

          // ========== è¾“å‡ºæ–‡ä»¶ç”Ÿæˆéƒ¨åˆ† ==========
          // åˆ›å»ºç›®æ ‡JSONå¯¹è±¡
          // é‡æ„è¯´æ˜ï¼šè¾“å‡ºçš„æ•°æ®ç»“æ„å®Œå…¨é€‚é…äº†IDè°ƒæ•´æœºåˆ¶ï¼Œç¡®ä¿äº†æ•°æ®çš„æ•´ä½“ä¸€è‡´æ€§
          // è¯¾ç¨‹åˆ—è¡¨ä¸­çš„IDä¸è¯¾ç¨‹å®‰æ’ä¸­çš„IDä¿æŒä¸€è‡´ï¼Œé¿å…äº†å› IDå†²çªå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜
          const outputJson = {
            basic: {
              dataStructureVersion: "1.1",
              dataSource: "wakeup",
              name: tableName,
              createTime: "",
              updateTime: "",
              courseStart: courseStart,
              courseEnd: courseEnd
            },
            courses: finalCourses,
            timetableTemplate: timetableTemplates,
            courseSchedule: courseSchedule
          };

          // å†™å…¥è¾“å‡ºæ–‡ä»¶
          console.log(`æˆåŠŸæå–ä¿¡æ¯: è¯¾è¡¨åç§°=${tableName}, å¼€å§‹æ—¥æœŸ=${courseStart}, ç»“æŸæ—¥æœŸ=${courseEnd}`);
          console.log(`æå–å¹¶å»é‡åå¾—åˆ°${finalCourses.length}é—¨è¯¾ç¨‹`);
          console.log('å®Œæ•´çš„è¾“å‡ºç»“æœ:');

          console.log(JSON.stringify(outputJson, null, 2));

          return outputJson
        } else {
          console.error('æœªæ‰¾åˆ°å¿…è¦çš„å­—æ®µ');
        }
      } catch (error) {
        console.error(`å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`);
      }
    }



    /*ä»¥ä¸Šä¸ºwakeupæ•°æ®è½¬æ¢*/






    // åŠ è½½é…ç½®
    function loadConfiguration(event) {
      const file = event.target.files[0];
      if (!file) return;

      // åˆ¤æ–­æ–‡ä»¶æ‰©å±•å
      const fileName = file.name;
      const lastDotIndex = fileName.lastIndexOf('.');
      const fileExtension = lastDotIndex > 0 ? fileName.slice(lastDotIndex + 1).toLowerCase() : '';
      console.log('æ–‡ä»¶æ‰©å±•å:', fileExtension);

      const reader = new FileReader();
      reader.onload = (e) => {

        let preData;

        if (fileExtension == "wakeup_schedule") {
          // å…ˆå¤„ç†wakeupçš„æ•°æ®
          try {
            preData = JSON.stringify(extractCourseData(e.target.result))
          } catch (error) {
            alert('Wakeupæ•°æ®è½¬æ¢å‡ºé”™');
            console.error(error);
            return
          }
        } else {
          preData = e.target.result
        }

        try {

          const data = JSON.parse(preData);

          // ç¡®ä¿æœ‰7å¤©çš„è¯¾ç¨‹å®‰æ’ï¼ŒæŒ‰å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåº
          if (!data.courseSchedule || data.courseSchedule.length !== 7) {
            const newSchedule = [];
            dayNames.forEach((_, i) => {
              newSchedule.push(data.courseSchedule?.[i] || {
                timetableId: [-1],
                timetableRepeatability: 1,
                courseList: []
              });
            });
            data.courseSchedule = newSchedule;
          }

          // ç¡®ä¿åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´å­˜åœ¨
          if (!data.basic.createTime) data.basic.createTime = getCurrentTimeString();
          if (!data.basic.updateTime) data.basic.updateTime = getCurrentTimeString();

          courseData = data;
          updateFormFromData();
          updateJsonPreview();

          // åŠ è½½æˆåŠŸå…è®¸è¿›å…¥ä¸‹ä¸€æ­¥
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          loadBtn.innerHTML = '<i class="fa fa-upload mr-2"></i>åŠ è½½æˆåŠŸ,ç‚¹å‡»ä¸‹ä¸€æ­¥ç»§ç»­é…ç½®'
          loadBtn.classList.remove('bg-secondary', 'hover:bg-secondary/90');
          loadBtn.classList.add('bg-accent', 'hover:bg-accent/90');
          NewBtn.classList.add('opacity-50', 'cursor-not-allowed');
          NewBtn.disabled = true;

        } catch (error) {
          alert('åŠ è½½é…ç½®å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
          console.error(error);
        }
      };
      reader.readAsText(file);
    }

    // ä»æ•°æ®æ›´æ–°è¡¨å•
    function updateFormFromData() {
      // æ›´æ–°åŸºç¡€ä¿¡æ¯
      document.getElementById('dataStructureVersion').value = courseData.basic.dataStructureVersion || '1.1';
      document.getElementById('name').value = courseData.basic.name || '';
      document.getElementById('createTime').value = courseData.basic.createTime || '';
      document.getElementById('updateTime').value = courseData.basic.updateTime || '';
      document.getElementById('courseStart').value = courseData.basic.courseStart || '';
      document.getElementById('courseEnd').value = courseData.basic.courseEnd || '';

      // æ›´æ–°è¯¾ç¨‹åˆ—è¡¨
      const coursesContainer = document.getElementById('coursesContainer');
      coursesContainer.innerHTML = '';
      courseData.courses.forEach((course, index) => {
        addCourseToDOM(course, index);
      });

      // æ›´æ–°æ—¶é—´è¡¨æ¨¡æ¿
      const templatesContainer = document.getElementById('templatesContainer');
      templatesContainer.innerHTML = '';

      // æ·»åŠ å…¶ä»–æ¨¡æ¿ï¼ˆä»ç´¢å¼•0å¼€å§‹ï¼‰
      for (let i = 0; i < courseData.timetableTemplate.length; i++) {
        addTemplateToDOM(courseData.timetableTemplate[i], i);
      }

      // æ›´æ–°è¯¾ç¨‹å®‰æ’ï¼ˆæŒ‰å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåºï¼‰
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });

      // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤º
      updateCourseIdDisplay();
    }

    // æ›´æ–°åŸºç¡€ä¿¡æ¯
    function updateBasicInfo() {
      courseData.basic.dataStructureVersion = document.getElementById('dataStructureVersion').value;
      courseData.basic.name = document.getElementById('name').value;
      courseData.basic.createTime = document.getElementById('createTime').value;
      courseData.basic.updateTime = document.getElementById('updateTime').value;
      courseData.basic.courseStart = document.getElementById('courseStart').value;
      courseData.basic.courseEnd = document.getElementById('courseEnd').value;

      updateJsonPreview();
    }

    // æ·»åŠ è¯¾ç¨‹
    function addCourse() {
      const newCourse = {
        courseName: "",
        teacher: "",
        classroom: ""
      };

      courseData.courses.push(newCourse);
      addCourseToDOM(newCourse, courseData.courses.length - 1);
      updateJsonPreview();
    }

    // æ·»åŠ è¯¾ç¨‹åˆ°DOM
    function addCourseToDOM(course, index) {
      const coursesContainer = document.getElementById('coursesContainer');

      const courseCard = document.createElement('div');
      courseCard.className = 'course-card bg-neutral rounded-lg p-4 card-hover';
      courseCard.dataset.index = index;

      courseCard.innerHTML = `
        <div class="flex justify-between items-start mb-3">
          <h4 class="font-medium">è¯¾ç¨‹ #${index + 1}</h4>
          <button class="delete-course text-red-500 hover:text-red-700 transition-colors">
            <i class="fa fa-trash"></i>
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">è¯¾ç¨‹åç§°</label>
            <input type="text" class="course-name w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šè¯­æ–‡" value="${course.courseName || ''}">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">æ•™å¸ˆ</label>
            <input type="text" class="course-teacher w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šå¼ è€å¸ˆ" value="${course.teacher || ''}">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">æ•™å®¤</label>
            <input type="text" class="course-classroom w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šæœ¬ç­" value="${course.classroom || ''}">
          </div>
        </div>
      `;

      coursesContainer.appendChild(courseCard);
    }

    // å¤„ç†è¯¾ç¨‹ç›¸å…³æ“ä½œ
    function handleCourseActions(e) {
      if (e.target.closest('.delete-course')) {
        const courseCard = e.target.closest('.course-card');
        const index = parseInt(courseCard.dataset.index);

        // ç§»é™¤æ•°æ®
        courseData.courses.splice(index, 1);

        // é‡æ–°æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
        const coursesContainer = document.getElementById('coursesContainer');
        coursesContainer.innerHTML = '';
        courseData.courses.forEach((course, i) => {
          addCourseToDOM(course, i);
        });

        // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤ºå’Œæ‰€æœ‰ç›¸å…³ä¸‹æ‹‰èœå•
        updateCourseIdDisplay();
        updateAllCourseDropdowns();
        updateJsonPreview();
      }
    }

    // æ›´æ–°è¯¾ç¨‹ä¿¡æ¯
    function updateCourseInfo(e) {
      if (e.target.classList.contains('course-name') ||
        e.target.classList.contains('course-teacher') ||
        e.target.classList.contains('course-classroom')) {

        const courseCard = e.target.closest('.course-card');
        const index = parseInt(courseCard.dataset.index);

        courseData.courses[index].courseName = courseCard.querySelector('.course-name').value;
        courseData.courses[index].teacher = courseCard.querySelector('.course-teacher').value;
        courseData.courses[index].classroom = courseCard.querySelector('.course-classroom').value;

        // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤ºå’Œæ‰€æœ‰ç›¸å…³ä¸‹æ‹‰èœå•
        updateCourseIdDisplay();
        updateAllCourseDropdowns();
        updateJsonPreview();
      }
    }

    // æ·»åŠ æ—¶é—´è¡¨æ¨¡æ¿
    function addTemplate() {
      const newTemplate = [
        {
          type: "start"
        },
        {
          type: "end",
          timeHour: defaultHour,
          timeMinute: defaultMinute
        }
      ];

      courseData.timetableTemplate.push(newTemplate);
      addTemplateToDOM(newTemplate, courseData.timetableTemplate.length - 1);

      // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
      updateAllScheduleDropdowns();
      updateJsonPreview();
    }

    // æ·»åŠ æ—¶é—´è¡¨æ¨¡æ¿åˆ°DOM
    function addTemplateToDOM(template, index) {
      const templatesContainer = document.getElementById('templatesContainer');

      const templateCard = document.createElement('div');
      templateCard.className = 'template-card bg-neutral rounded-lg p-4 card-hover';
      templateCard.dataset.index = index;

      templateCard.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h4 class="font-medium">æ—¶é—´è¡¨æ¨¡æ¿ #${index + 1}</h4>
          <div class="flex space-x-2">
            <button class="add-time-node bg-accent hover:bg-accent/90 text-white px-3 py-1 rounded transition-all text-sm flex items-center">
              <i class="fa fa-plus mr-1"></i>æ·»åŠ èŠ‚ç‚¹
            </button>
            <button class="delete-template text-red-500 hover:text-red-700 transition-colors">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="time-nodes space-y-3">
        </div>
      `;

      // æ·»åŠ æ—¶é—´èŠ‚ç‚¹
      const timeNodesContainer = templateCard.querySelector('.time-nodes');
      template.forEach((node, nodeIndex) => {
        const timeNode = createTimeNodeElement(node, nodeIndex);
        timeNodesContainer.appendChild(timeNode);
      });

      templatesContainer.appendChild(templateCard);
    }

    // åˆ›å»ºæ—¶é—´èŠ‚ç‚¹å…ƒç´ 
    function createTimeNodeElement(node, index) {
      const timeNode = document.createElement('div');
      timeNode.className = 'time-node bg-white rounded p-3 border border-gray-200';
      timeNode.dataset.index = index;

      // å¯¹äºstartç±»å‹ï¼Œéšè—æ—¶é—´è¾“å…¥ï¼Œå…¶ä»–ç±»å‹æ˜¾ç¤º
      const showTime = node.type !== 'start';

      timeNode.innerHTML = `
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium">æ—¶é—´èŠ‚ç‚¹ #${index + 1}</span>
          <button class="delete-time-node text-red-500 hover:text-red-700 transition-colors text-sm ${index === 0 && node.type === 'start' ? 'opacity-50 cursor-not-allowed' : ''}" 
                  ${index === 0 && node.type === 'start' ? 'disabled' : ''}>
            <i class="fa fa-times"></i>
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ç±»å‹</label>
            <select class="time-type w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus">
              <option value="start" ${node.type === 'start' ? 'selected' : ''}>å¼€å§‹ (start)</option>
              <option value="course" ${node.type === 'course' ? 'selected' : ''}>è¯¾ç¨‹ (course)</option>
              <option value="interval" ${node.type === 'interval' ? 'selected' : ''}>è¯¾é—´ (interval)</option>
              <option value="rest" ${node.type === 'rest' ? 'selected' : ''}>ä¼‘æ¯ (rest)</option>
              <option value="end" ${node.type === 'end' ? 'selected' : ''}>ç»“æŸ (end)</option>
            </select>
          </div>
          <div class="time-time ${showTime ? '' : 'hidden'}">
            <label class="block text-sm font-medium text-gray-700 mb-1">å¼€å§‹æ—¶é—´  æ—¶</label>
            <input type="number" min="0" max="23" class="time-hour w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="00" value="${node.timeHour || ''}">
          </div>
          <div class="time-time ${showTime ? '' : 'hidden'}">
            <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†</label>
            <input type="number" min="0" max="59" class="time-minute w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="00" value="${node.timeMinute || ''}">
          </div>
        </div>
      `;

      return timeNode;
    }

    // å¤„ç†æ¨¡æ¿ç›¸å…³æ“ä½œ
    function handleTemplateActions(e) {
      // æ·»åŠ æ—¶é—´èŠ‚ç‚¹
      if (e.target.closest('.add-time-node') && !e.target.closest('.template-locked')) {
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const timeNodesContainer = templateCard.querySelector('.time-nodes');
        const lastNodeIndex = timeNodesContainer.children.length;

        // åˆ›å»ºæ–°çš„æ—¶é—´èŠ‚ç‚¹
        const newNode = {
          type: "course",
          timeHour: defaultHour,
          timeMinute: defaultMinute
        };

        // æ·»åŠ åˆ°æ•°æ®
        courseData.timetableTemplate[templateIndex].splice(lastNodeIndex - 1, 0, newNode);

        // æ›´æ–°DOM
        timeNodesContainer.innerHTML = '';
        courseData.timetableTemplate[templateIndex].forEach((node, nodeIndex) => {
          const timeNode = createTimeNodeElement(node, nodeIndex);
          timeNodesContainer.appendChild(timeNode);
        });

        updateJsonPreview();
      }

      // åˆ é™¤æ—¶é—´èŠ‚ç‚¹
      if (e.target.closest('.delete-time-node') && !e.target.closest('.template-locked')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);

        // ç¡®ä¿è‡³å°‘ä¿ç•™å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹
        if (courseData.timetableTemplate[templateIndex].length > 2) {
          // ä»æ•°æ®ä¸­åˆ é™¤
          courseData.timetableTemplate[templateIndex].splice(nodeIndex, 1);

          // æ›´æ–°DOM
          const timeNodesContainer = templateCard.querySelector('.time-nodes');
          timeNodesContainer.innerHTML = '';
          courseData.timetableTemplate[templateIndex].forEach((node, i) => {
            const newTimeNode = createTimeNodeElement(node, i);
            timeNodesContainer.appendChild(newTimeNode);
          });

          updateJsonPreview();
        }
      }

      // åˆ é™¤æ¨¡æ¿ï¼ˆä»…å…è®¸åˆ é™¤éé»˜è®¤æ¨¡æ¿ï¼‰
      if (e.target.closest('.delete-template')) {
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);

        // ä»æ•°æ®ä¸­åˆ é™¤
        courseData.timetableTemplate.splice(templateIndex, 1);

        // æ›´æ–°DOM
        const templatesContainer = document.getElementById('templatesContainer');
        templatesContainer.innerHTML = '';

        // é‡æ–°æ·»åŠ å‰©ä½™æ¨¡æ¿
        courseData.timetableTemplate.forEach((template, i) => {
          addTemplateToDOM(template, i);
        });

        // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
        updateAllScheduleDropdowns();
        updateJsonPreview();
      }
    }

    // æ›´æ–°æ¨¡æ¿ä¿¡æ¯
    function updateTemplateInfo(e) {
      // å¤„ç†æ—¶é—´èŠ‚ç‚¹ç±»å‹å˜åŒ–
      if (e.target.classList.contains('time-type')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const type = e.target.value;

        // æ›´æ–°æ•°æ®
        courseData.timetableTemplate[templateIndex][nodeIndex].type = type;

        // æ˜¾ç¤ºæˆ–éšè—æ—¶é—´è¾“å…¥
        const timeInputs = timeNode.querySelectorAll('.time-time');
        if (type === 'start') {
          timeInputs.forEach(input => input.classList.add('hidden'));
          // ç§»é™¤æ—¶é—´å±æ€§
          delete courseData.timetableTemplate[templateIndex][nodeIndex].timeHour;
          delete courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute;
        } else {
          timeInputs.forEach(input => input.classList.remove('hidden'));
          // ç¡®ä¿æ—¶é—´å±æ€§å­˜åœ¨
          if (!courseData.timetableTemplate[templateIndex][nodeIndex].timeHour) {
            courseData.timetableTemplate[templateIndex][nodeIndex].timeHour = defaultHour;
            timeNode.querySelector('.time-hour').value = defaultHour;
          }
          if (!courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute) {
            courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute = defaultMinute;
            timeNode.querySelector('.time-minute').value = defaultMinute;
          }
        }

        updateJsonPreview();
      }

      // å¤„ç†å°æ—¶å˜åŒ–
      if (e.target.classList.contains('time-hour')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const hour = e.target.value.padStart(2, '0');

        courseData.timetableTemplate[templateIndex][nodeIndex].timeHour = hour;
        updateJsonPreview();
      }

      // å¤„ç†åˆ†é’Ÿå˜åŒ–
      if (e.target.classList.contains('time-minute')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const minute = e.target.value.padStart(2, '0');

        courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute = minute;
        updateJsonPreview();
      }
    }

    // å¤„ç†è¯¾ç¨‹å®‰æ’å˜åŒ–
    function handleScheduleChange(e) {
      // å¤„ç†æ—¶é—´è¡¨æ¨¡æ¿å˜åŒ–
      if (e.target.classList.contains('timetable-id')) {
        const dayCard = e.target.closest('.day-card');
        const dayContainer = dayCard.parentElement;
        const dayIndex = parseInt(dayContainer.id.split('-')[1]);
        const timetableId = parseInt(e.target.value);

        courseData.courseSchedule[dayIndex].timetableId = [timetableId];

        // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
        renderDayContent(dayIndex, dayNames[dayIndex]);

        updateJsonPreview();
      }

      // å¤„ç†è¯¾ç¨‹é€‰æ‹©å˜åŒ–
      if (e.target.classList.contains('course-id')) {
        const courseItem = e.target.closest('.course-item');
        const courseList = e.target.closest('.course-list');
        const dayIndex = parseInt(courseList.dataset.dayIndex);
        const itemIndex = Array.from(courseList.children).indexOf(courseItem);
        const courseId = e.target.value ? [parseInt(e.target.value)] : [];

        if (courseData.courseSchedule[dayIndex].courseList[itemIndex]) {
          courseData.courseSchedule[dayIndex].courseList[itemIndex].courseId = courseId;
        }

        updateJsonPreview();
      }
    }

    // å¤„ç†æ·»åŠ è¯¾ç¨‹åˆ°å®‰æ’
    function handleAddCourseToSchedule(e) {
      // è·å–å½“å‰å¤©çš„ç´¢å¼•
      const addButton = e.target.closest('.add-course-to-schedule');
      const dayCard = addButton.closest('.day-card');
      const dayContainer = dayCard.parentElement;
      const dayIndex = parseInt(dayContainer.id.split('-')[1]);

      // æ·»åŠ åˆ°æ•°æ®
      const newCourseItem = {
        courseId: [],
        courseRepeatability: 1
      };
      courseData.courseSchedule[dayIndex].courseList.push(newCourseItem);

      // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
      renderDayContent(dayIndex, dayNames[dayIndex]);

      updateJsonPreview();
    }

    // å¤„ç†ä»å®‰æ’ä¸­åˆ é™¤è¯¾ç¨‹
    function handleDeleteCourseFromSchedule(e) {
      const courseItem = e.target.closest('.course-item');
      const courseList = e.target.closest('.course-list');
      const dayIndex = parseInt(courseList.dataset.dayIndex);
      const itemIndex = Array.from(courseList.children).indexOf(courseItem);

      // ä»æ•°æ®ä¸­åˆ é™¤
      courseData.courseSchedule[dayIndex].courseList.splice(itemIndex, 1);

      // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
      renderDayContent(dayIndex, dayNames[dayIndex]);

      updateJsonPreview();
    }

    // æ›´æ–°è¯¾ç¨‹å®‰æ’ä¿¡æ¯
    function updateScheduleInfo(e) {
      // å¤„ç†æ¨¡æ¿é‡å¤æ¬¡æ•°å˜åŒ–
      if (e.target.classList.contains('timetable-repeatability')) {
        const dayCard = e.target.closest('.day-card');
        const dayContainer = dayCard.parentElement;
        const dayIndex = parseInt(dayContainer.id.split('-')[1]);
        const repeatability = parseInt(e.target.value) || 1;

        courseData.courseSchedule[dayIndex].timetableRepeatability = repeatability;
        updateJsonPreview();
      }

      // å¤„ç†è¯¾ç¨‹é‡å¤æ¬¡æ•°å˜åŒ–
      if (e.target.classList.contains('course-repeatability')) {
        const courseItem = e.target.closest('.course-item');
        const courseList = e.target.closest('.course-list');
        const dayIndex = parseInt(courseList.dataset.dayIndex);
        const itemIndex = Array.from(courseList.children).indexOf(courseItem);
        const repeatability = parseInt(e.target.value) || 1;

        if (courseData.courseSchedule[dayIndex].courseList[itemIndex]) {
          courseData.courseSchedule[dayIndex].courseList[itemIndex].courseRepeatability = repeatability;
        }

        updateJsonPreview();
      }
    }

    // æ›´æ–°æ‰€æœ‰è¯¾ç¨‹ä¸‹æ‹‰èœå•
    function updateAllCourseDropdowns() {
      // åªæ›´æ–°å†…å®¹ï¼Œä¸æ”¹å˜é¡ºåº
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });
    }

    // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
    function updateAllScheduleDropdowns() {
      // ä¿æŒå‘¨ä¸€è‡³å‘¨æ—¥çš„å›ºå®šé¡ºåºï¼Œåªæ›´æ–°å†…å®¹
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });
    }

    // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤º
    function updateCourseIdDisplay() {
      document.querySelectorAll('.course-card').forEach((card, index) => {
        card.querySelector('h4').textContent = `è¯¾ç¨‹ #${index + 1}`;
        card.dataset.index = index;
      });
    }

    // åˆå§‹åŒ–é¡µé¢
    //document.addEventListener('DOMContentLoaded', init);

    // å…¬å‘Šå¼¹çª—æ§åˆ¶é€»è¾‘
    function initAnnouncementModal() {
      const modal = document.getElementById('announcementModal');
      const closeBtn = document.getElementById('closeAnnouncementBtn');
      const confirmBtn = document.getElementById('confirmAnnouncementBtn');

      modal.style.visibility = "visible";

      // å…³é—­å¼¹çª—å‡½æ•°
      function closeModal() {
        modal.classList.add('opacity-0');
        modal.querySelector('div').classList.add('scale-95');
        setTimeout(() => {
          modal.style.display = 'none';
        }, 300);
      }

      // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­å¼¹çª—
      closeBtn.addEventListener('click', closeModal);
      // ç‚¹å‡»ç¡®è®¤æŒ‰é’®å…³é—­å¼¹çª—
      confirmBtn.addEventListener('click', closeModal);
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨èƒŒæ™¯å…³é—­å¼¹çª—
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    function isQQBrowser() {
      var userAgent = navigator.userAgent;
      return /MQQBrowser/i.test(userAgent);
    }
    if (isQQBrowser()) {
      console.log("ç”¨æˆ·æ­£åœ¨ä½¿ç”¨QQæµè§ˆå™¨");
    }
    // å¤åˆ¶å½“å‰é¡µé¢é“¾æ¥åˆ°å‰ªè´´æ¿
    function copyLink() {
      const currentUrl = window.location.href;
      navigator.clipboard.writeText(currentUrl)
        .then(() => {
          alert('é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´åˆ°æµè§ˆå™¨æ‰“å¼€');
        })
        .catch(err => {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
        });
    }
    // ç»§ç»­è®¿é—®å½“å‰é¡µé¢
    function continueAccess() {
      document.getElementById('qqMask').classList.remove('show');

      init(); // åŸé¡µé¢çš„åˆå§‹åŒ–å‡½æ•°
    }

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºå…¬å‘Šå¼¹çª—
    document.addEventListener('DOMContentLoaded', () => {
      const qqMask = document.getElementById('qqMask');
      if (isQQBrowser()) {
        // æ£€æµ‹åˆ°QQå®¢æˆ·ç«¯ï¼šæ˜¾ç¤ºé®ç½©
        qqMask.classList.add('show');
      } else {
        // éQQç¯å¢ƒï¼šéšè—é®ç½©
        qqMask.classList.remove('show');

        init(); // åŸé¡µé¢çš„åˆå§‹åŒ–å‡½æ•°
      }
    });

  </script>
</body>

</html>