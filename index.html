<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="author" content="Eason Chen">
  <meta name="email" content="admin@xuanimage.top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¾„åºè¯¾ç¨‹è¡¨-é…ç½®ç”Ÿæˆå™¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#10b981',
            neutral: '#f1f5f9',
            dark: '#1e293b'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .step-active {
        @apply bg-primary text-white border-primary;
      }
      .step-completed {
        @apply bg-accent text-white border-accent;
      }
      .step-pending {
        @apply bg-white text-secondary border-secondary;
      }
      .form-input-focus {
        @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .template-locked {
        @apply border-dashed border-gray-400 bg-gray-50;
      }
      .no-course-message {
        @apply text-gray-500 italic text-sm mt-2;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

  <!-- å…¬å‘Šå¼¹çª— -->
  <div id="announcementModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-lg max-w-2xl w-full mx-4 overflow-hidden transform transition-all duration-300 scale-100">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <div class="bg-primary text-white px-6 py-4 flex justify-between items-center">
        <h3 class="text-lg font-bold">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</h3>
        <button id="closeAnnouncementBtn" class="text-white hover:text-gray-200 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <!-- å¼¹çª—å†…å®¹ï¼ˆå¯è‡ªå®šä¹‰ HTMLï¼‰ -->
      <div class="p-6 space-y-4">
        <p class="text-gray-700">ä½¿ç”¨å¸®åŠ©</p>
        <ul class="list-disc pl-5 text-gray-600 space-y-2">
          <li>è¯¥é¡µé¢ä¸º <a href="https://www.waterflames.cn/">æ¾„åºè¯¾ç¨‹è¡¨â€”â€”è¯¾ç¨‹è…•ä¸ŠæŠ¬æ‰‹çœ‹</a> é…ç½®é¡µé¢ V0.1.4-Beta </li>
          <li>è‹¥é‡åˆ°å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œè¯·ç‚¹å‡»ã€Œä¿å­˜é…ç½®ã€ååˆ·æ–°é¡µé¢ï¼Œã€ŒåŠ è½½é…ç½®ã€åå³å¯é‡æ–°é…ç½®</li>
          <li>è‹¥å¯¼å…¥å¤±è´¥è¯·æ£€æŸ¥æ•°æ®æ ¼å¼è§„èŒƒ</li>
          <li>æµ‹è¯•ç¾¤ï¼š1042873150</li>
        </ul>
        <div class="pt-2 text-right">
          <a href="https://github.com/cyx200902/">
            <span class="text-sm text-gray-500" >Eason Chen</span><br>
          </a>
          <span class="text-sm text-gray-500" >25.8.30</span>
        </div>
      </div>
      <!-- å¼¹çª—åº•éƒ¨ -->
      <div class="bg-gray-50 px-6 py-4 flex justify-end">
        <button id="confirmAnnouncementBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-check mr-2"></i>æˆ‘å·²çŸ¥æ™“
        </button>
      </div>
    </div>
  </div>

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white shadow-sm sticky top-0 z-40">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-calendar-check-o text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-dark">æ¾„åºè¯¾ç¨‹è¡¨é…ç½®ç”Ÿæˆå™¨</h1>
      </div>
      <div class="flex items-center space-x-4">
        <a href="https://astrobox.online/open?source=res&res=%E6%BE%84%E5%BA%8F%E8%AF%BE%E7%A8%8B%E8%A1%A8&provider=official" target="_blank" rel="noopener noreferrer">
              <img height="40px" src="https://astrobox.online/goab/en/white.svg">
        </a>
        <button id="saveBtn" class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-save mr-2"></i>ä¿å­˜é…ç½®
        </button>
        <button id="loadBtn" class="bg-secondary hover:bg-secondary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-upload mr-2"></i>åŠ è½½é…ç½®
        </button>
        <input type="file" id="fileInput" accept=".json" class="hidden">
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="mb-10">
      <div class="flex flex-wrap items-center justify-between">
        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step1Indicator" class="step-active w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">1</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">åŸºç¡€ä¿¡æ¯è®¾ç½®</h2>
            <p class="text-sm text-gray-500">é…ç½®è¯¾ç¨‹è¡¨çš„åŸºæœ¬ä¿¡æ¯</p>
          </div>
        </div>
        
        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        
        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step2Indicator" class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">2</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h2>
            <p class="text-sm text-gray-500">æ·»åŠ å’Œç¼–è¾‘è¯¾ç¨‹è¯¦æƒ…</p>
          </div>
        </div>
        
        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar2" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        
        <div class="flex items-center w-full md:w-auto mb-4 md:mb-0">
          <div id="step3Indicator" class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">3</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">æ—¶é—´è¡¨æ¨¡æ¿</h2>
            <p class="text-sm text-gray-500">è®¾ç½®æ¯æ—¥æ—¶é—´èŠ‚ç‚¹</p>
          </div>
        </div>
        
        <div class="hidden md:block flex-1 max-w-md mx-4 h-1 bg-gray-200 rounded-full">
          <div id="progressBar3" class="h-full bg-primary rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        
        <div class="flex items-center w-full md:w-auto">
          <div id="step4Indicator" class="step-pending w-10 h-10 rounded-full border flex items-center justify-center font-medium mr-4">4</div>
          <div>
            <h2 class="text-lg font-semibold text-dark">è¯¾ç¨‹å®‰æ’</h2>
            <p class="text-sm text-gray-500">åˆ†é…æ¯æ—¥è¯¾ç¨‹</p>
          </div>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤å†…å®¹åŒºåŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- å·¦ä¾§è¡¨å•åŒºåŸŸ -->
      <div class="lg:col-span-2 space-y-6">
        <!-- æ­¥éª¤1: åŸºç¡€ä¿¡æ¯ -->
        <div id="step1" class="bg-white rounded-xl shadow-sm p-6 transition-all">
          <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-100">è¯¾ç¨‹è¡¨åŸºç¡€ä¿¡æ¯</h3>
          
          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="dataStructureVersion">æ•°æ®æ ¼å¼ç‰ˆæœ¬</label>
                <input type="text" id="dataStructureVersion" value="1.1" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus cursor-not-allowed" disabled>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="name">è¯¾ç¨‹è¡¨åç§°</label>
                <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šé«˜äºŒä¸‹å­¦æœŸè¯¾ç¨‹è¡¨" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="createTime">åˆ›å»ºæ—¶é—´</label>
                <input type="text" id="createTime" placeholder="æ ¼å¼ï¼šYYMMDDHHmmss" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="updateTime">ä¿®æ”¹æ—¶é—´</label>
                <input type="text" id="updateTime" placeholder="æ ¼å¼ï¼šYYMMDDHHmmss" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="courseStart">è¯¾ç¨‹å¼€å§‹æ—¥æœŸ</label>
                <input type="text" id="courseStart" placeholder="æ ¼å¼ï¼šYYMMDD" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" for="courseEnd">è¯¾ç¨‹ç»“æŸæ—¥æœŸ</label>
                <input type="text" id="courseEnd" placeholder="æ ¼å¼ï¼šYYMMDD" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus">
              </div>
            </div>
          </div>
        </div>
        
        <!-- æ­¥éª¤2: è¯¾ç¨‹ä¿¡æ¯ -->
        <div id="step2" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold pb-2 border-b border-gray-100">è¯¾ç¨‹ä¿¡æ¯ç®¡ç†</h3>
            <button id="addCourseBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
              <i class="fa fa-plus mr-2"></i>æ·»åŠ è¯¾ç¨‹
            </button>
          </div>
          
          <div id="coursesContainer" class="space-y-4">
            <!-- è¯¾ç¨‹å¡ç‰‡ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
          </div>
        </div>
        
        <!-- æ­¥éª¤3: æ—¶é—´è¡¨æ¨¡æ¿ -->
        <div id="step3" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold pb-2 border-b border-gray-100">æ—¶é—´è¡¨æ¨¡æ¿ç®¡ç†</h3>
            <button id="addTemplateBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all flex items-center">
              <i class="fa fa-plus mr-2"></i>æ·»åŠ æ¨¡æ¿
            </button>
          </div>
          
          <div id="templatesContainer" class="space-y-8">
            <!-- é”å®šçš„æ— è¯¾ç¨‹æ¨¡æ¿ -->
            
          </div>
        </div>
        
        <!-- æ­¥éª¤4: è¯¾ç¨‹å®‰æ’ -->
        <div id="step4" class="bg-white rounded-xl shadow-sm p-6 transition-all hidden">
          <h3 class="text-xl font-bold mb-6 pb-2 border-b border-gray-100">è¯¾ç¨‹å®‰æ’</h3>
          
          <div id="scheduleContainer" class="space-y-6">
            <!-- æ¯å¤©çš„å®‰æ’ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            <!-- å‘¨ä¸€åˆ°å‘¨æ—¥ä¼šé€šè¿‡JSè‡ªåŠ¨ç”Ÿæˆ -->
          </div>
        </div>
        
        <!-- å¯¼èˆªæŒ‰é’® -->
        <div class="flex justify-between mt-8">
          <button id="prevBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center opacity-50 cursor-not-allowed">
            <i class="fa fa-arrow-left mr-2"></i>ä¸Šä¸€æ­¥
          </button>
          <button id="nextBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all flex items-center">
            ä¸‹ä¸€æ­¥<i class="fa fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>
      
      <!-- å³ä¾§JSONé¢„è§ˆåŒºåŸŸ -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24 z-30">
          <h3 class="text-xl font-bold mb-4 pb-2 border-b border-gray-100">JSONé…ç½®é¢„è§ˆ</h3>
          <div class="relative">
            <button id="copyJsonBtn" class="absolute top-2 right-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm transition-all">
              <i class="fa fa-copy mr-1"></i>å¤åˆ¶
            </button>
            <pre id="jsonPreview" class="bg-gray-50 p-4 rounded-lg text-sm overflow-x-auto max-h-[600px] font-mono"></pre>
          </div>
          <div id="copyAlert" class="mt-2 text-sm text-accent hidden">
            <i class="fa fa-check mr-1"></i>å·²å¤åˆ¶åˆ°å‰ªè´´æ¿
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-dark text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p>æ¾„åºè¯¾ç¨‹è¡¨é…ç½®ç”Ÿæˆå™¨</p> 
      <p class="flex items-center justify-center mt-2">
        <a href="https://github.com/cyx200902/" target="_blank">
          <img src="https://img.shields.io/badge/Eason%20Chen-black?logo=github" 
              style="vertical-align: middle; margin: 0 auto;">
        </a>
      </p>
      <p>Â© 2019-2025 WaterFlames.cn. All Rights Reserved.ï½œ<a href="https://beian.miit.gov.cn/">é—½ICPå¤‡2024035715å·-1</a>ï½œ<a href="https://www.12377.cn/">ä¸­å›½äº’è”ç½‘è¿æ³•å’Œä¸è‰¯ä¿¡æ¯ä¸¾æŠ¥ä¸­å¿ƒ</a></p>
    </div>
  </footer>

  <script>
    // å½“å‰æ­¥éª¤
    let currentStep = 1;
    const totalSteps = 4;
    
    // è·å–å½“å‰é¡¹ç›®å¼€å§‹æ—¶é—´ä½œä¸ºé»˜è®¤æ—¶é—´
    const now = new Date();
    const defaultHour = now.getHours().toString().padStart(2, '0');
    const defaultMinute = now.getMinutes().toString().padStart(2, '0');
    
    // ç”Ÿæˆå½“å‰æ—¶é—´çš„é»˜è®¤æ ¼å¼ (YYMMDDHHmmss)
    const getCurrentTimeString = () => {
      const date = new Date();
      const year = date.getFullYear().toString().slice(2);
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      const seconds = date.getSeconds().toString().padStart(2, '0');
      return `${year}${month}${day}${hours}${minutes}${seconds}`;
    };
    
    // åˆå§‹åŒ–æ•°æ®ç»“æ„
    let courseData = {
      basic: {
        dataStructureVersion: "1.1",
        name: "",
        createTime: getCurrentTimeString(),
        updateTime: getCurrentTimeString(),
        courseStart: "",
        courseEnd: ""
      },
      courses: [], // åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼Œä¸é»˜è®¤åˆ›å»ºè¯¾ç¨‹
      timetableTemplate: [
        // æ–°ç‰ˆæœ¬ä¸ä¼ ç©ºæ¨¡æ¿äº†ï¼Œä¼ -1
        // // ç©ºçš„æ— è¯¾ç¨‹æ¨¡æ¿ï¼ˆç´¢å¼•0ï¼‰
        // [
        //   {"type": "start"},
        //   {"type": "end"}
        // ]
      ],
      courseSchedule: [] // å°†é€šè¿‡JSåˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥
    };
    
    // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’ï¼ˆå›ºå®šé¡ºåºï¼‰
    const dayNames = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
    dayNames.forEach(() => {
      courseData.courseSchedule.push({
        timetableId: [-1], // æ–°ç‰ˆæœ¬é»˜è®¤ä¼ -1
        timetableRepeatability: 1,
        courseList: []
      });
    });

    // DOM å…ƒç´ 
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');
    
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    const jsonPreview = document.getElementById('jsonPreview');
    const copyJsonBtn = document.getElementById('copyJsonBtn');
    const copyAlert = document.getElementById('copyAlert');
    
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const fileInput = document.getElementById('fileInput');

    // æ­¥éª¤æŒ‡ç¤ºå™¨
    const stepIndicators = [
      document.getElementById('step1Indicator'),
      document.getElementById('step2Indicator'),
      document.getElementById('step3Indicator'),
      document.getElementById('step4Indicator')
    ];
    
    // è¿›åº¦æ¡
    const progressBars = [
      document.getElementById('progressBar'),
      document.getElementById('progressBar2'),
      document.getElementById('progressBar3')
    ];

    // åˆå§‹åŒ–é¡µé¢
    function init() {
      // è®¾ç½®åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´çš„é»˜è®¤å€¼
      document.getElementById('createTime').value = courseData.basic.createTime;
      document.getElementById('updateTime').value = courseData.basic.updateTime;
      
      updateStepUI();
      updateJsonPreview();
      setupEventListeners();
      
      // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’UIï¼ˆå›ºå®šé¡ºåºï¼‰
      initWeekDaysSchedule();
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // æ­¥éª¤å¯¼èˆª
      prevBtn.addEventListener('click', goToPrevStep);
      nextBtn.addEventListener('click', goToNextStep);
      
      // å¤åˆ¶JSON
      copyJsonBtn.addEventListener('click', copyJsonToClipboard);
      
      // ä¿å­˜å’ŒåŠ è½½é…ç½®
      saveBtn.addEventListener('click', saveConfiguration);
      loadBtn.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', loadConfiguration);
      
      // åŸºç¡€ä¿¡æ¯è¾“å…¥å˜åŒ–
      document.getElementById('dataStructureVersion').addEventListener('input', updateBasicInfo);
      document.getElementById('name').addEventListener('input', updateBasicInfo);
      document.getElementById('createTime').addEventListener('input', updateBasicInfo);
      document.getElementById('updateTime').addEventListener('input', updateBasicInfo);
      document.getElementById('courseStart').addEventListener('input', updateBasicInfo);
      document.getElementById('courseEnd').addEventListener('input', updateBasicInfo);
      
      // è¯¾ç¨‹ç®¡ç†
      document.getElementById('addCourseBtn').addEventListener('click', addCourse);
      document.getElementById('coursesContainer').addEventListener('click', handleCourseActions);
      document.getElementById('coursesContainer').addEventListener('input', updateCourseInfo);
      
      // æ—¶é—´è¡¨æ¨¡æ¿ç®¡ç†
      document.getElementById('addTemplateBtn').addEventListener('click', addTemplate);
      document.getElementById('templatesContainer').addEventListener('click', handleTemplateActions);
      document.getElementById('templatesContainer').addEventListener('change', updateTemplateInfo);
      
      // è¯¾ç¨‹å®‰æ’ç®¡ç†
      document.getElementById('scheduleContainer').addEventListener('change', handleScheduleChange);
      document.getElementById('scheduleContainer').addEventListener('click', function(e) {
        // å¤„ç†æ·»åŠ è¯¾ç¨‹æŒ‰é’®ç‚¹å‡»
        if (e.target.closest('.add-course-to-schedule')) {
          const btn = e.target.closest('.add-course-to-schedule');
          if (!btn.disabled) {
            handleAddCourseToSchedule(e);
          }
          return;
        }
        
        // å¤„ç†åˆ é™¤è¯¾ç¨‹æŒ‰é’®ç‚¹å‡»
        if (e.target.closest('.delete-course-item')) {
          handleDeleteCourseFromSchedule(e);
          return;
        }
      });
      document.getElementById('scheduleContainer').addEventListener('input', updateScheduleInfo);
    }

    // åˆå§‹åŒ–å‘¨ä¸€è‡³å‘¨æ—¥çš„è¯¾ç¨‹å®‰æ’UIï¼ˆå›ºå®šé¡ºåºï¼‰
    function initWeekDaysSchedule() {
      const scheduleContainer = document.getElementById('scheduleContainer');
      scheduleContainer.innerHTML = '';
      
      // ä¸¥æ ¼æŒ‰ç…§å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåºæ·»åŠ 
      dayNames.forEach((dayName, index) => {
        // åˆ›å»ºæ¯ä¸€å¤©çš„å®¹å™¨å¹¶ä¿ç•™åœ¨DOMä¸­
        const dayContainer = document.createElement('div');
        dayContainer.id = `dayContainer-${index}`;
        scheduleContainer.appendChild(dayContainer);
        
        // æ¸²æŸ“å½“å¤©å†…å®¹
        renderDayContent(index, dayName);
      });
    }

    // æ¸²æŸ“ç‰¹å®šå¤©çš„å†…å®¹
    function renderDayContent(dayIndex, dayName) {
      const dayContainer = document.getElementById(`dayContainer-${dayIndex}`);
      if (!dayContainer) return;
      
      const dayData = courseData.courseSchedule[dayIndex];
      
      // ç”Ÿæˆæ—¶é—´è¡¨æ¨¡æ¿ä¸‹æ‹‰é€‰é¡¹
      let timetableOptions = '<option value="-1" >ä»Šæ—¥æ— è¯¾</option>';
      courseData.timetableTemplate.forEach((_, i) => {
        timetableOptions += `<option value="${i}" ${dayData.timetableId[0] === i ? 'selected' : ''}>æ¨¡æ¿ #${i + 1}</option>`;
      });
      
      
      // ç”Ÿæˆè¯¾ç¨‹ä¸‹æ‹‰é€‰é¡¹
      let courseOptions = '<option value="">é€‰æ‹©è¯¾ç¨‹</option>';
      courseData.courses.forEach((course, i) => {
        const courseName = course.courseName || `è¯¾ç¨‹ #${i + 1}`;
        courseOptions += `<option value="${i}">${courseName}</option>`;
      });
      
      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ— è¯¾ç¨‹æ¨¡æ¿
      const isNoCourseTemplate = dayData.timetableId[0] === -1;
      
      dayContainer.innerHTML = `
        <div class="day-card bg-neutral rounded-lg p-4 card-hover">
          <div class="flex justify-between items-start mb-4">
            <h4 class="font-medium">${dayName}</h4>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">æ—¶é—´è¡¨æ¨¡æ¿</label>
              <select class="timetable-id w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus">
                ${timetableOptions}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">æ¨¡æ¿é‡å¤æ¬¡æ•°</label>
              <input type="number" min="1" class="timetable-repeatability w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                    value="${dayData.timetableRepeatability || 1}">
            </div>
          </div>
          
          <div class="mb-4">
            <div class="flex justify-between items-center mb-3">
              <h5 class="font-medium">è¯¾ç¨‹åˆ—è¡¨</h5>
              <button class="add-course-to-schedule bg-accent hover:bg-accent/90 text-white px-3 py-1 rounded transition-all text-sm flex items-center ${isNoCourseTemplate ? 'opacity-50 cursor-not-allowed' : ''}"
                      ${isNoCourseTemplate ? 'disabled' : ''}>
                <i class="fa fa-plus mr-1"></i>æ·»åŠ è¯¾ç¨‹
              </button>
            </div>
            
            ${isNoCourseTemplate ? '<p class="no-course-message text-gray-500 italic mb-3">å½“æ—¥æ— è¯¾ç¨‹</p>' : ''}
            
            <div class="course-list space-y-3" data-day-index="${dayIndex}">
              ${dayData.courseList.map((courseItem, itemIndex) => `
                <div class="course-item bg-white rounded p-3 border border-gray-200 flex flex-col md:flex-row gap-3">
                  <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯¾ç¨‹</label>
                    <select class="course-id w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" ${isNoCourseTemplate ? 'disabled' : ''}>
                      ${courseOptions}
                    </select>
                  </div>
                  <div class="w-full md:w-32">
                    <label class="block text-sm font-medium text-gray-700 mb-1">é‡å¤æ¬¡æ•°</label>
                    <input type="number" min="1" class="course-repeatability w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                          value="${courseItem.courseRepeatability || 1}" ${isNoCourseTemplate ? 'disabled' : ''}>
                  </div>
                  <div class="flex items-end">
                    <button class="delete-course-item text-red-500 hover:text-red-700 transition-colors p-2 ${isNoCourseTemplate ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${isNoCourseTemplate ? 'disabled' : ''}>
                      <i class="fa fa-trash"></i>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      
      // è®¾ç½®å·²é€‰æ‹©çš„è¯¾ç¨‹
      const courseItems = dayContainer.querySelectorAll('.course-item');
      courseItems.forEach((item, itemIndex) => {
        const courseId = dayData.courseList[itemIndex]?.courseId?.[0];
        if (courseId !== undefined) {
          const select = item.querySelector('.course-id');
          select.value = courseId;
        }
      });
    }

    // æ›´æ–°æ­¥éª¤UI
    function updateStepUI() {
      // éšè—æ‰€æœ‰æ­¥éª¤
      step1.classList.add('hidden');
      step2.classList.add('hidden');
      step3.classList.add('hidden');
      step4.classList.add('hidden');
      
      // æ˜¾ç¤ºå½“å‰æ­¥éª¤
      switch(currentStep) {
        case 1:
          step1.classList.remove('hidden');
          prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = true;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 2:
          step2.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 3:
          step3.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = false;
          break;
        case 4:
          step4.classList.remove('hidden');
          prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          prevBtn.disabled = false;
          nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
          nextBtn.disabled = true;
          break;
      }
      
      // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
      stepIndicators.forEach((indicator, index) => {
        indicator.classList.remove('step-active', 'step-completed', 'step-pending');
        if (index + 1 < currentStep) {
          indicator.classList.add('step-completed');
        } else if (index + 1 === currentStep) {
          indicator.classList.add('step-active');
        } else {
          indicator.classList.add('step-pending');
        }
      });
      
      // æ›´æ–°è¿›åº¦æ¡
      progressBars.forEach((bar, index) => {
        bar.style.width = (index + 1 < currentStep) ? '100%' : '0%';
      });
      
      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ä¸Šä¸€æ­¥
    function goToPrevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateStepUI();
        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        nextBtn.disabled = false;
      }
    }

    // ä¸‹ä¸€æ­¥
    function goToNextStep() {
      if (currentStep < totalSteps) {
        // å½“ä»æ­¥éª¤3åˆ°æ­¥éª¤4æ—¶ï¼Œæ›´æ–°è¯¾ç¨‹å®‰æ’çš„ä¸‹æ‹‰é€‰é¡¹
        if (currentStep === 3) {
          updateAllScheduleDropdowns();
        }
        currentStep++;
        updateStepUI();
      }
    }

    // æ›´æ–°JSONé¢„è§ˆ
    function updateJsonPreview() {
      jsonPreview.textContent = JSON.stringify(courseData, null, 2);
    }

    // å¤åˆ¶JSONåˆ°å‰ªè´´æ¿
    function copyJsonToClipboard() {
      navigator.clipboard.writeText(jsonPreview.textContent).then(() => {
        copyAlert.classList.remove('hidden');
        setTimeout(() => {
          copyAlert.classList.add('hidden');
        }, 2000);
      });
    }

    // ä¿å­˜é…ç½®
    function saveConfiguration() {
      // ä¿å­˜å‰æ›´æ–°ä¿®æ”¹æ—¶é—´
      courseData.basic.updateTime = getCurrentTimeString();
      document.getElementById('updateTime').value = courseData.basic.updateTime;
      
      const jsonStr = JSON.stringify(courseData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = courseData.basic.name ? `${courseData.basic.name}.json` : 'courseData.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      updateJsonPreview();
    }

    // åŠ è½½é…ç½®
    function loadConfiguration(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          
          // ç¡®ä¿æœ‰7å¤©çš„è¯¾ç¨‹å®‰æ’ï¼ŒæŒ‰å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåº
          if (!data.courseSchedule || data.courseSchedule.length !== 7) {
            const newSchedule = [];
            dayNames.forEach((_, i) => {
              newSchedule.push(data.courseSchedule?.[i] || {
                timetableId: [-1],
                timetableRepeatability: 1,
                courseList: []
              });
            });
            data.courseSchedule = newSchedule;
          }
          
          // ç¡®ä¿åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´å­˜åœ¨
          if (!data.basic.createTime) data.basic.createTime = getCurrentTimeString();
          if (!data.basic.updateTime) data.basic.updateTime = getCurrentTimeString();
          
          courseData = data;
          updateFormFromData();
          updateJsonPreview();
        } catch (error) {
          alert('åŠ è½½é…ç½®å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
          console.error(error);
        }
      };
      reader.readAsText(file);
    }

    // ä»æ•°æ®æ›´æ–°è¡¨å•
    function updateFormFromData() {
      // æ›´æ–°åŸºç¡€ä¿¡æ¯
      document.getElementById('dataStructureVersion').value = courseData.basic.dataStructureVersion || '1.1';
      document.getElementById('name').value = courseData.basic.name || '';
      document.getElementById('createTime').value = courseData.basic.createTime || '';
      document.getElementById('updateTime').value = courseData.basic.updateTime || '';
      document.getElementById('courseStart').value = courseData.basic.courseStart || '';
      document.getElementById('courseEnd').value = courseData.basic.courseEnd || '';
      
      // æ›´æ–°è¯¾ç¨‹åˆ—è¡¨
      const coursesContainer = document.getElementById('coursesContainer');
      coursesContainer.innerHTML = '';
      courseData.courses.forEach((course, index) => {
        addCourseToDOM(course, index);
      });

      // æ›´æ–°æ—¶é—´è¡¨æ¨¡æ¿
      const templatesContainer = document.getElementById('templatesContainer');
      templatesContainer.innerHTML = '';

      // æ·»åŠ å…¶ä»–æ¨¡æ¿ï¼ˆä»ç´¢å¼•0å¼€å§‹ï¼‰
      for (let i = 0; i < courseData.timetableTemplate.length; i++) {
        addTemplateToDOM(courseData.timetableTemplate[i], i);
      }
      
      // æ›´æ–°è¯¾ç¨‹å®‰æ’ï¼ˆæŒ‰å‘¨ä¸€è‡³å‘¨æ—¥é¡ºåºï¼‰
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });
      
      // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤º
      updateCourseIdDisplay();
    }

    // æ›´æ–°åŸºç¡€ä¿¡æ¯
    function updateBasicInfo() {
      courseData.basic.dataStructureVersion = document.getElementById('dataStructureVersion').value;
      courseData.basic.name = document.getElementById('name').value;
      courseData.basic.createTime = document.getElementById('createTime').value;
      courseData.basic.updateTime = document.getElementById('updateTime').value;
      courseData.basic.courseStart = document.getElementById('courseStart').value;
      courseData.basic.courseEnd = document.getElementById('courseEnd').value;
      
      updateJsonPreview();
    }

    // æ·»åŠ è¯¾ç¨‹
    function addCourse() {
      const newCourse = {
        courseName: "",
        teacher: "",
        classroom: ""
      };
      
      courseData.courses.push(newCourse);
      addCourseToDOM(newCourse, courseData.courses.length - 1);
      updateJsonPreview();
    }

    // æ·»åŠ è¯¾ç¨‹åˆ°DOM
    function addCourseToDOM(course, index) {
      const coursesContainer = document.getElementById('coursesContainer');
      
      const courseCard = document.createElement('div');
      courseCard.className = 'course-card bg-neutral rounded-lg p-4 card-hover';
      courseCard.dataset.index = index;
      
      courseCard.innerHTML = `
        <div class="flex justify-between items-start mb-3">
          <h4 class="font-medium">è¯¾ç¨‹ #${index + 1}</h4>
          <button class="delete-course text-red-500 hover:text-red-700 transition-colors">
            <i class="fa fa-trash"></i>
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">è¯¾ç¨‹åç§°</label>
            <input type="text" class="course-name w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šè¯­æ–‡" value="${course.courseName || ''}">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">æ•™å¸ˆ</label>
            <input type="text" class="course-teacher w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šå¼ è€å¸ˆ" value="${course.teacher || ''}">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">æ•™å®¤</label>
            <input type="text" class="course-classroom w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="ä¾‹å¦‚ï¼šæœ¬ç­" value="${course.classroom || ''}">
          </div>
        </div>
      `;
      
      coursesContainer.appendChild(courseCard);
    }

    // å¤„ç†è¯¾ç¨‹ç›¸å…³æ“ä½œ
    function handleCourseActions(e) {
      if (e.target.closest('.delete-course')) {
        const courseCard = e.target.closest('.course-card');
        const index = parseInt(courseCard.dataset.index);
        
        // ç§»é™¤æ•°æ®
        courseData.courses.splice(index, 1);
        
        // é‡æ–°æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
        const coursesContainer = document.getElementById('coursesContainer');
        coursesContainer.innerHTML = '';
        courseData.courses.forEach((course, i) => {
          addCourseToDOM(course, i);
        });
        
        // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤ºå’Œæ‰€æœ‰ç›¸å…³ä¸‹æ‹‰èœå•
        updateCourseIdDisplay();
        updateAllCourseDropdowns();
        updateJsonPreview();
      }
    }

    // æ›´æ–°è¯¾ç¨‹ä¿¡æ¯
    function updateCourseInfo(e) {
      if (e.target.classList.contains('course-name') || 
          e.target.classList.contains('course-teacher') || 
          e.target.classList.contains('course-classroom')) {
          
        const courseCard = e.target.closest('.course-card');
        const index = parseInt(courseCard.dataset.index);
        
        courseData.courses[index].courseName = courseCard.querySelector('.course-name').value;
        courseData.courses[index].teacher = courseCard.querySelector('.course-teacher').value;
        courseData.courses[index].classroom = courseCard.querySelector('.course-classroom').value;
        
        // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤ºå’Œæ‰€æœ‰ç›¸å…³ä¸‹æ‹‰èœå•
        updateCourseIdDisplay();
        updateAllCourseDropdowns();
        updateJsonPreview();
      }
    }

    // æ·»åŠ æ—¶é—´è¡¨æ¨¡æ¿
    function addTemplate() {
      const newTemplate = [
        {
          type: "start"
        },
        {
          type: "end",
          timeHour: defaultHour,
          timeMinute: defaultMinute
        }
      ];
      
      courseData.timetableTemplate.push(newTemplate);
      addTemplateToDOM(newTemplate, courseData.timetableTemplate.length - 1);
      
      // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
      updateAllScheduleDropdowns();
      updateJsonPreview();
    }

    // æ·»åŠ æ—¶é—´è¡¨æ¨¡æ¿åˆ°DOM
    function addTemplateToDOM(template, index) {
      const templatesContainer = document.getElementById('templatesContainer');
      
      const templateCard = document.createElement('div');
      templateCard.className = 'template-card bg-neutral rounded-lg p-4 card-hover';
      templateCard.dataset.index = index;
      
      templateCard.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h4 class="font-medium">æ—¶é—´è¡¨æ¨¡æ¿ #${index + 1}</h4>
          <div class="flex space-x-2">
            <button class="add-time-node bg-accent hover:bg-accent/90 text-white px-3 py-1 rounded transition-all text-sm flex items-center">
              <i class="fa fa-plus mr-1"></i>æ·»åŠ èŠ‚ç‚¹
            </button>
            <button class="delete-template text-red-500 hover:text-red-700 transition-colors">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="time-nodes space-y-3">
        </div>
      `;
      
      // æ·»åŠ æ—¶é—´èŠ‚ç‚¹
      const timeNodesContainer = templateCard.querySelector('.time-nodes');
      template.forEach((node, nodeIndex) => {
        const timeNode = createTimeNodeElement(node, nodeIndex);
        timeNodesContainer.appendChild(timeNode);
      });
      
      templatesContainer.appendChild(templateCard);
    }

    // åˆ›å»ºæ—¶é—´èŠ‚ç‚¹å…ƒç´ 
    function createTimeNodeElement(node, index) {
      const timeNode = document.createElement('div');
      timeNode.className = 'time-node bg-white rounded p-3 border border-gray-200';
      timeNode.dataset.index = index;
      
      // å¯¹äºstartç±»å‹ï¼Œéšè—æ—¶é—´è¾“å…¥ï¼Œå…¶ä»–ç±»å‹æ˜¾ç¤º
      const showTime = node.type !== 'start';
      
      timeNode.innerHTML = `
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium">æ—¶é—´èŠ‚ç‚¹ #${index + 1}</span>
          <button class="delete-time-node text-red-500 hover:text-red-700 transition-colors text-sm ${index === 0 && node.type === 'start' ? 'opacity-50 cursor-not-allowed' : ''}" 
                  ${index === 0 && node.type === 'start' ? 'disabled' : ''}>
            <i class="fa fa-times"></i>
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ç±»å‹</label>
            <select class="time-type w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus">
              <option value="start" ${node.type === 'start' ? 'selected' : ''}>å¼€å§‹ (start)</option>
              <option value="course" ${node.type === 'course' ? 'selected' : ''}>è¯¾ç¨‹ (course)</option>
              <option value="interval" ${node.type === 'interval' ? 'selected' : ''}>è¯¾é—´ (interval)</option>
              <option value="rest" ${node.type === 'rest' ? 'selected' : ''}>ä¼‘æ¯ (rest)</option>
              <option value="end" ${node.type === 'end' ? 'selected' : ''}>ç»“æŸ (end)</option>
            </select>
          </div>
          <div class="time-time ${showTime ? '' : 'hidden'}">
            <label class="block text-sm font-medium text-gray-700 mb-1">å¼€å§‹æ—¶é—´  æ—¶</label>
            <input type="number" min="0" max="23" class="time-hour w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="00" value="${node.timeHour || ''}">
          </div>
          <div class="time-time ${showTime ? '' : 'hidden'}">
            <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†</label>
            <input type="number" min="0" max="59" class="time-minute w-full px-3 py-2 border border-gray-300 rounded-lg form-input-focus" 
                  placeholder="00" value="${node.timeMinute || ''}">
          </div>
        </div>
      `;
      
      return timeNode;
    }

    // å¤„ç†æ¨¡æ¿ç›¸å…³æ“ä½œ
    function handleTemplateActions(e) {
      // æ·»åŠ æ—¶é—´èŠ‚ç‚¹
      if (e.target.closest('.add-time-node') && !e.target.closest('.template-locked')) {
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const timeNodesContainer = templateCard.querySelector('.time-nodes');
        const lastNodeIndex = timeNodesContainer.children.length;
        
        // åˆ›å»ºæ–°çš„æ—¶é—´èŠ‚ç‚¹
        const newNode = {
          type: "course",
          timeHour: defaultHour,
          timeMinute: defaultMinute
        };
        
        // æ·»åŠ åˆ°æ•°æ®
        courseData.timetableTemplate[templateIndex].splice(lastNodeIndex - 1, 0, newNode);
        
        // æ›´æ–°DOM
        timeNodesContainer.innerHTML = '';
        courseData.timetableTemplate[templateIndex].forEach((node, nodeIndex) => {
          const timeNode = createTimeNodeElement(node, nodeIndex);
          timeNodesContainer.appendChild(timeNode);
        });
        
        updateJsonPreview();
      }
      
      // åˆ é™¤æ—¶é—´èŠ‚ç‚¹
      if (e.target.closest('.delete-time-node') && !e.target.closest('.template-locked')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        
        // ç¡®ä¿è‡³å°‘ä¿ç•™å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹
        if (courseData.timetableTemplate[templateIndex].length > 2) {
          // ä»æ•°æ®ä¸­åˆ é™¤
          courseData.timetableTemplate[templateIndex].splice(nodeIndex, 1);
          
          // æ›´æ–°DOM
          const timeNodesContainer = templateCard.querySelector('.time-nodes');
          timeNodesContainer.innerHTML = '';
          courseData.timetableTemplate[templateIndex].forEach((node, i) => {
            const newTimeNode = createTimeNodeElement(node, i);
            timeNodesContainer.appendChild(newTimeNode);
          });
          
          updateJsonPreview();
        }
      }
      
      // åˆ é™¤æ¨¡æ¿ï¼ˆä»…å…è®¸åˆ é™¤éé»˜è®¤æ¨¡æ¿ï¼‰
      if (e.target.closest('.delete-template')) {
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        
        // ä»æ•°æ®ä¸­åˆ é™¤
        courseData.timetableTemplate.splice(templateIndex, 1);
        
        // æ›´æ–°DOM
        const templatesContainer = document.getElementById('templatesContainer');
        templatesContainer.innerHTML = '';
        
        // é‡æ–°æ·»åŠ å‰©ä½™æ¨¡æ¿
        courseData.timetableTemplate.forEach((template, i) => {
            addTemplateToDOM(template, i);
        });
        
        // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
        updateAllScheduleDropdowns();
        updateJsonPreview();
      }
    }

    // æ›´æ–°æ¨¡æ¿ä¿¡æ¯
    function updateTemplateInfo(e) {
      // å¤„ç†æ—¶é—´èŠ‚ç‚¹ç±»å‹å˜åŒ–
      if (e.target.classList.contains('time-type')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const type = e.target.value;
        
        // æ›´æ–°æ•°æ®
        courseData.timetableTemplate[templateIndex][nodeIndex].type = type;
        
        // æ˜¾ç¤ºæˆ–éšè—æ—¶é—´è¾“å…¥
        const timeInputs = timeNode.querySelectorAll('.time-time');
        if (type === 'start') {
          timeInputs.forEach(input => input.classList.add('hidden'));
          // ç§»é™¤æ—¶é—´å±æ€§
          delete courseData.timetableTemplate[templateIndex][nodeIndex].timeHour;
          delete courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute;
        } else {
          timeInputs.forEach(input => input.classList.remove('hidden'));
          // ç¡®ä¿æ—¶é—´å±æ€§å­˜åœ¨
          if (!courseData.timetableTemplate[templateIndex][nodeIndex].timeHour) {
            courseData.timetableTemplate[templateIndex][nodeIndex].timeHour = defaultHour;
            timeNode.querySelector('.time-hour').value = defaultHour;
          }
          if (!courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute) {
            courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute = defaultMinute;
            timeNode.querySelector('.time-minute').value = defaultMinute;
          }
        }
        
        updateJsonPreview();
      }
      
      // å¤„ç†å°æ—¶å˜åŒ–
      if (e.target.classList.contains('time-hour')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const hour = e.target.value.padStart(2, '0');
        
        courseData.timetableTemplate[templateIndex][nodeIndex].timeHour = hour;
        updateJsonPreview();
      }
      
      // å¤„ç†åˆ†é’Ÿå˜åŒ–
      if (e.target.classList.contains('time-minute')) {
        const timeNode = e.target.closest('.time-node');
        const templateCard = e.target.closest('.template-card');
        const templateIndex = parseInt(templateCard.dataset.index);
        const nodeIndex = parseInt(timeNode.dataset.index);
        const minute = e.target.value.padStart(2, '0');
        
        courseData.timetableTemplate[templateIndex][nodeIndex].timeMinute = minute;
        updateJsonPreview();
      }
    }

    // å¤„ç†è¯¾ç¨‹å®‰æ’å˜åŒ–
    function handleScheduleChange(e) {
      // å¤„ç†æ—¶é—´è¡¨æ¨¡æ¿å˜åŒ–
      if (e.target.classList.contains('timetable-id')) {
        const dayCard = e.target.closest('.day-card');
        const dayContainer = dayCard.parentElement;
        const dayIndex = parseInt(dayContainer.id.split('-')[1]);
        const timetableId = parseInt(e.target.value);
        
        courseData.courseSchedule[dayIndex].timetableId = [timetableId];
        
        // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
        renderDayContent(dayIndex, dayNames[dayIndex]);
        
        updateJsonPreview();
      }
      
      // å¤„ç†è¯¾ç¨‹é€‰æ‹©å˜åŒ–
      if (e.target.classList.contains('course-id')) {
        const courseItem = e.target.closest('.course-item');
        const courseList = e.target.closest('.course-list');
        const dayIndex = parseInt(courseList.dataset.dayIndex);
        const itemIndex = Array.from(courseList.children).indexOf(courseItem);
        const courseId = e.target.value ? [parseInt(e.target.value)] : [];
        
        if (courseData.courseSchedule[dayIndex].courseList[itemIndex]) {
          courseData.courseSchedule[dayIndex].courseList[itemIndex].courseId = courseId;
        }
        
        updateJsonPreview();
      }
    }

    // å¤„ç†æ·»åŠ è¯¾ç¨‹åˆ°å®‰æ’
    function handleAddCourseToSchedule(e) {
      // è·å–å½“å‰å¤©çš„ç´¢å¼•
      const addButton = e.target.closest('.add-course-to-schedule');
      const dayCard = addButton.closest('.day-card');
      const dayContainer = dayCard.parentElement;
      const dayIndex = parseInt(dayContainer.id.split('-')[1]);
      
      // æ·»åŠ åˆ°æ•°æ®
      const newCourseItem = {
        courseId: [],
        courseRepeatability: 1
      };
      courseData.courseSchedule[dayIndex].courseList.push(newCourseItem);
      
      // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
      renderDayContent(dayIndex, dayNames[dayIndex]);
      
      updateJsonPreview();
    }

    // å¤„ç†ä»å®‰æ’ä¸­åˆ é™¤è¯¾ç¨‹
    function handleDeleteCourseFromSchedule(e) {
      const courseItem = e.target.closest('.course-item');
      const courseList = e.target.closest('.course-list');
      const dayIndex = parseInt(courseList.dataset.dayIndex);
      const itemIndex = Array.from(courseList.children).indexOf(courseItem);
      
      // ä»æ•°æ®ä¸­åˆ é™¤
      courseData.courseSchedule[dayIndex].courseList.splice(itemIndex, 1);
      
      // åªæ›´æ–°å½“å‰å¤©çš„å†…å®¹ï¼Œä¸æ”¹å˜ä½ç½®
      renderDayContent(dayIndex, dayNames[dayIndex]);
      
      updateJsonPreview();
    }

    // æ›´æ–°è¯¾ç¨‹å®‰æ’ä¿¡æ¯
    function updateScheduleInfo(e) {
      // å¤„ç†æ¨¡æ¿é‡å¤æ¬¡æ•°å˜åŒ–
      if (e.target.classList.contains('timetable-repeatability')) {
        const dayCard = e.target.closest('.day-card');
        const dayContainer = dayCard.parentElement;
        const dayIndex = parseInt(dayContainer.id.split('-')[1]);
        const repeatability = parseInt(e.target.value) || 1;
        
        courseData.courseSchedule[dayIndex].timetableRepeatability = repeatability;
        updateJsonPreview();
      }
      
      // å¤„ç†è¯¾ç¨‹é‡å¤æ¬¡æ•°å˜åŒ–
      if (e.target.classList.contains('course-repeatability')) {
        const courseItem = e.target.closest('.course-item');
        const courseList = e.target.closest('.course-list');
        const dayIndex = parseInt(courseList.dataset.dayIndex);
        const itemIndex = Array.from(courseList.children).indexOf(courseItem);
        const repeatability = parseInt(e.target.value) || 1;
        
        if (courseData.courseSchedule[dayIndex].courseList[itemIndex]) {
          courseData.courseSchedule[dayIndex].courseList[itemIndex].courseRepeatability = repeatability;
        }
        
        updateJsonPreview();
      }
    }

    // æ›´æ–°æ‰€æœ‰è¯¾ç¨‹ä¸‹æ‹‰èœå•
    function updateAllCourseDropdowns() {
      // åªæ›´æ–°å†…å®¹ï¼Œä¸æ”¹å˜é¡ºåº
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });
    }

    // æ›´æ–°æ‰€æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰èœå•
    function updateAllScheduleDropdowns() {
      // ä¿æŒå‘¨ä¸€è‡³å‘¨æ—¥çš„å›ºå®šé¡ºåºï¼Œåªæ›´æ–°å†…å®¹
      dayNames.forEach((dayName, index) => {
        renderDayContent(index, dayName);
      });
    }

    // æ›´æ–°è¯¾ç¨‹IDæ˜¾ç¤º
    function updateCourseIdDisplay() {
      document.querySelectorAll('.course-card').forEach((card, index) => {
        card.querySelector('h4').textContent = `è¯¾ç¨‹ #${index + 1}`;
        card.dataset.index = index;
      });
    }

    // åˆå§‹åŒ–é¡µé¢
    //document.addEventListener('DOMContentLoaded', init);

    // å…¬å‘Šå¼¹çª—æ§åˆ¶é€»è¾‘
    function initAnnouncementModal() {
      const modal = document.getElementById('announcementModal');
      const closeBtn = document.getElementById('closeAnnouncementBtn');
      const confirmBtn = document.getElementById('confirmAnnouncementBtn');

      // å…³é—­å¼¹çª—å‡½æ•°
      function closeModal() {
        modal.classList.add('opacity-0');
        modal.querySelector('div').classList.add('scale-95');
        setTimeout(() => {
          modal.style.display = 'none';
        }, 300);
      }

      // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­å¼¹çª—
      closeBtn.addEventListener('click', closeModal);
      // ç‚¹å‡»ç¡®è®¤æŒ‰é’®å…³é—­å¼¹çª—
      confirmBtn.addEventListener('click', closeModal);
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨èƒŒæ™¯å…³é—­å¼¹çª—
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºå…¬å‘Šå¼¹çª—
    document.addEventListener('DOMContentLoaded', () => {
      // å…ˆåˆå§‹åŒ–å…¬å‘Šå¼¹çª—ï¼Œå†æ‰§è¡ŒåŸé¡µé¢åˆå§‹åŒ–
      initAnnouncementModal();
      init(); // åŸé¡µé¢çš„åˆå§‹åŒ–å‡½æ•°
    });

  </script>
</body>
</html>
